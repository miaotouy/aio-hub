# 项目未来功能与重构计划 (TODO)

本文档记录了项目未来的开发方向和待办事项，用于规划和追踪长期目标。

---

## ✅ 已完成功能（0.1.7 → 0.1.9-beta.1）

### 核心架构
- [x] **多窗口系统**：组件分离架构、自定义窗口管理、位置/尺寸持久化
- [x] **全局资产管理（AMS）**：统一文件管理、哈希去重、缩略图生成、asset:// 协议
- [x] **配置系统升级**：ZIP 归档备份/恢复、窗口配置自动保存
- [x] **数据持久化优化**：分离式存储、增量保存

### LLM Chat 模块
- [x] **树形对话历史**：多分支对话、分支切换、记忆导航
- [x] **智能体系统（Agent）**：
  - [x] 预设消息系统（system/user/assistant/chat_history 占位符）
  - [x] 从模板创建（内置代码助手、创意写作等预设）
  - [x] 图标支持（emoji + 自定义图片）
  - [x] 参数配置（temperature、top_p、工具调用等）
- [x] **用户档案（UserProfile）**：
  - [x] 全局默认 + 智能体绑定优先级
  - [x] 消息元数据快照
- [x] **多模态附件系统**：
  - [x] 支持图片、视频、文档
  - [x] 拖拽/粘贴添加
  - [x] 异步导入 + 即时预览
- [x] **高级功能**：
  - [x] 消息编辑（原地修改 + 分支创建）
  - [x] 并行生成
  - [x] 上下文分析器（结构化/原始/图表三视图）
  - [x] 流式推理展示（reasoning_content）

### 渲染与 UI
- [x] **富文本渲染引擎 V2**：自定义解析器、AST diff 算法、稳定区/待定区策略
- [x] **代码块优化**：stream-monaco + shiki 语法高亮、主题自动适配、工具栏
- [x] **主题系统**：自定义主题色、CSS 覆盖、暗色模式增强
- [x] **图片查看器**：基于 Viewer.js 的全局查看器

### 模型管理
- [x] **元数据系统**：能力、分组、价格等通用元数据
- [x] **能力系统**：vision、reasoning、toolUse、imageGeneration 等 10+ 能力
- [x] **预设系统**：自动匹配规则、合并和独占逻辑
- [x] **扩展支持**：新增 15+ 提供商（Mistral、百度文心、零一万物、魔搭等）

### 工具更新
- [x] **新增工具**：
  - [x] 目录清理工具（DirectoryJanitor）
  - [x] 富文本渲染器测试（RichTextRendererTester）
- [x] **工具改进**：
  - [x] Git 分析器：流式加载、git2 库、分支懒加载、提交类型筛选
  - [x] 智能 OCR：三栏布局、拖拽调整、优化切片参数
  - [x] 正则工具：快捷规则面板、Rust 兼容性验证
  - [x] LLM 代理：模块化重构
- [x] **工具管理**：分类标签、搜索过滤、自定义排序、可见性开关

---

## 🎯 当前开发重点

### 阶段一：核心架构完善

#### 1.1 工具结构重构 (高优先级)
- [ ] **探索设计方案**：
  - [ ] 调研 Service Locator 和 Dependency Injection 模式在 Vue 3 中的最佳实践
  - [ ] 设计对现有结构破坏性最小、但收益最高的方案
  - [ ] 评估重构对现有工具的影响范围
  
- [ ] **业务逻辑分离**：
  - [ ] 将工具的核心逻辑抽离为独立的 Service 类
  - [ ] 设计统一的工具注册接口（注册元数据、能力声明、依赖关系等）
  - [ ] 实现工具发现机制（支持动态加载、热重载）
  
- [ ] **调用机制实现**：
  - [ ] 设计统一的工具调用协议（输入/输出规范、错误处理）
  - [ ] 实现工具间的依赖注入和通信机制
  - [ ] 为 Function Calling 预留扩展点

#### 1.2 多模态处理增强
- [ ] **自动降维处理**：
  - [ ] 实现模型能力检测逻辑（基于现有能力系统）
  - [ ] 为不支持多模态的模型自动调用 OCR 转写图片
  - [ ] 集成 ASR 服务，自动转写音视频内容为文本
  - [ ] 在上下文构建时智能选择原始内容或转写文本

---

## 🚀 未来规划

### 阶段二：Chat 模块深化

#### 2.1 Function Calling
- [ ] **工具调用能力** (依赖：工具结构重构)：
  - [ ] 允许 Chat 模块调用应用内已注册的工具
  - [ ] 设计工具调用的参数验证和错误处理机制
  - [ ] 实现工具调用结果的自动注入到上下文
  - [ ] 支持多步工具调用（链式调用、并行调用）

#### 2.2 用户档案增强
- [ ] **高级档案功能**：
  - [ ] 支持自定义档案内容在上下文中的插入位置（前置、后置、替换等）
  - [ ] 实现档案模板系统（预设角色、场景等）
  - [ ] 支持档案继承和组合（基础档案 + 扩展档案）

### 阶段三：新工具开发

#### 3.1 视频解析与归档工具
- [ ] **核心功能**：
  - [ ] 实现对主流视频网站的视频信息爬取（Bilibili、YouTube 等）
  - [ ] 支持下载视频的字幕、弹幕和评论区内容
  - [ ] 将解析后的文本内容归档为结构化数据
  - [ ] 与 Chat 模块集成，支持直接引用视频内容作为上下文

#### 3.2 酒馆内容导入工具
- [ ] **格式设计**：
  - [ ] 参考酒馆和其他平台，设计项目自有的角色卡/场景文件格式
  - [ ] 确保格式的可扩展性和向后兼容性
  
- [ ] **导入功能**：
  - [ ] 实现对酒馆格式的解析和导入
  - [ ] 转换为项目自有格式，保留核心信息
  - [ ] 支持批量导入和预览

### 阶段四：用户体验优化

#### 4.1 UI/UX 整体提升
- [x] 主题系统完善（已完成）
- [ ] **布局优化**：
  - [ ] 优化整体界面布局，提升空间利用率
  - [ ] 改进响应式设计，适配不同窗口尺寸
  - [ ] 统一视觉语言，提升一致性和美观度

#### 4.2 国际化 (i18n)
- [ ] **基础设施**：
  - [ ] 引入 vue-i18n 框架
  - [ ] 设计翻译文件结构和命名规范
  
- [ ] **内容迁移**：
  - [ ] 识别并提取所有硬编码文本
  - [ ] 逐步替换为 i18n key
  - [ ] 提供至少中文和英文两种语言

#### 4.3 新手引导 (Onboarding)
- [ ] **引导系统**：
  - [ ] 设计首次启动的欢迎界面
  - [ ] 实现工具列表的快速配置
  - [ ] 提供核心功能的交互式教程
  
- [ ] **个性化设置**：
  - [ ] 允许用户自定义默认显示的工具
  - [ ] 支持工具分组和自定义标签
  - [ ] 简化主界面，提升易用性

### 阶段五：核心理念与长期目标

#### 5.1 工具设计哲学
- [ ] **工具离线化**：优先保证核心工具的离线可用性，减少对网络连接的依赖，确保在断网环境下依然高效。
- [ ] **透明化与人性化**：工具设计应直观、易于人类直接操作，避免成为只能由 AI 调用的“黑盒”。在 AI 自动化和人类手动控制之间寻求平衡，让用户始终拥有选择权和控制权。

---

## 📝 技术债务与优化

### 性能优化
- [ ] 优化大型对话的渲染性能（虚拟滚动、懒加载）
- [ ] 减少不必要的响应式更新（shallowRef、markRaw）
- [ ] 优化资产管理的内存占用

### 代码质量
- [ ] 增加单元测试覆盖率（核心 composables、工具逻辑）
- [ ] 完善 TypeScript 类型定义（减少 any 使用）
- [ ] 统一代码风格和注释规范

### 文档完善
- [ ] 补充各工具的使用文档
- [ ] 编写开发者指南（如何添加新工具、如何扩展功能）
- [ ] 创建贡献指南（代码规范、PR 流程）

---

## 💡 创意与探索

### 潜在功能
- [ ] 探索本地 LLM 集成（Ollama、LM Studio）
- [ ] 研究语音交互功能（TTS/STT）
- [ ] 调研知识库管理（RAG、向量数据库）
- [ ] 考虑插件系统（允许第三方扩展）

### 社区建设
- [ ] 建立用户反馈渠道
- [ ] 创建示例和最佳实践库
- [ ] 组织功能投票和优先级排序
