# 设计文档：多算法色彩分析工作台 (Color Analysis Workbench)

本文档旨在详细阐述“多算法色彩分析工作台”工具的设计方案，作为后续开发工作的指导。

## 1. 项目目标

开发一个集成化的桌面端工具，允许用户从图片中提取色彩方案。该工具将提供多种业界主流的颜色分析算法，并与 AIO Hub 现有生态（资产管理、UI 组件、状态管理）深度集成，提供一个功能强大且体验统一的色彩分析解决方案。

## 2. 核心功能

1.  **多算法分析引擎**: 用户上传一张图片后，可自由切换三种不同的分析算法：
    *   **主色调提取 (Quantize)**: 基于 `color-thief-ts`，提取图片中出现频率最高的N种颜色。
    *   **设计感提取 (Vibrant)**: 基于 `node-vibrant`，提取出6种具有设计语义的颜色（如鲜艳、柔和等）。
    *   **平均色提取 (Average)**: 基于 `fast-average-color`，快速计算出整张图片的平均色。

2.  **全局颜色格式切换**: 提供全局切换栏，让用户可以统一设置颜色值的显示和复制格式（HEX, RGB, HSL）。

3.  **手动精确取色**: 作为辅助功能，提供放大镜和颜色信息面板，允许用户在图片的任意位置手动拾取颜色。

4.  **资产管理集成**: 所有用户上传的图片都将被注册到项目的资产管理系统中，生成持久化的 `asset://` URI，确保资源的可追溯性和持久性。

5.  **历史记录**: 自动保存每一次的分析记录（包括源图片资产URI和分析结果），用户可以随时查看和恢复历史会话。

## 3. 技术架构

### 3.1. 核心依赖

*   `color-thief-ts`: 用于主色调提取。
*   `node-vibrant`: 用于设计感调色板提取。
*   `fast-average-color`: 用于平均色计算。

### 3.2. 项目集成

*   **状态管理**: 创建独立的 Pinia Store (`src/tools/color-picker/colorPicker.store.ts`)，负责管理当前状态、历史记录和用户偏好。状态将通过 Pinia 持久化插件保存。
*   **资产管理**: 使用全局的 `useAssetManager` Composable。图片上传后立即注册为资产，后续所有操作均通过 `asset://` URI 进行。
*   **UI 组件**: 全面复用 `src/components/common/` 下的通用组件，如 `DropZone`, `InfoCard`, `BaseDialog`, `Avatar` 等，确保视觉和交互的统一。
*   **文件交互**: 使用 `useFileInteraction` Composable 处理图片的拖放、选择和粘贴。

### 3.3. 文件结构

```
src/
└── tools/
    └── color-picker/
        ├── components/
        │   ├── ColorLoupe.vue       # 放大镜组件
        │   ├── PaletteDisplay.vue   # 调色板展示组件
        │   └── HistoryDialog.vue    # 历史记录弹窗
        ├── composables/
        │   ├── useColorExtractor.ts # 封装三种算法的核心逻辑
        │   └── useColorConverter.ts # 封装颜色格式转换逻辑
        ├── colorPicker.store.ts     # Pinia 状态管理
        └── ColorPicker.vue          # 工具主界面组件
```

## 4. UI/UX 设计

### 4.1. 整体布局

采用经典的**左右分栏式布局**，左侧为图片交互区，右侧为结果分析区。在窄屏幕下自动切换为上下布局。

```
┌─────────────────────────────────────────────────────────────┐
│  [历史记录] [清除]                            Color Picker   │ ← 顶部工具栏
├────────────────────────────┬────────────────────────────────┤
│                            │  [主色调] [设计感] [平均色]    │ ← 算法选择器
│                            ├────────────────────────────────┤
│                            │  [ HEX ] [ RGB ] [ HSL ]       │ ← 全局颜色格式切换条
│                            ├────────────────────────────────┤
│      图片预览区             │                                │
│   (DropZone / Canvas)      │        分析结果展示区           │
│                            │                                │
│                            │   (根据上方格式条动态显示)     │
│                            │                                │
│                            ├────────────────────────────────┤
│                            │   [手动取色面板] ▼             │ ← 可折叠
└────────────────────────────┴────────────────────────────────┘
```

### 4.2. 交互细节

*   **左侧 (图片工作区)**: 初始为 `DropZone`。图片加载后，显示图片并提供放大镜取色功能。顶部提供“历史记录”、“清除”等操作。
*   **右侧 (分析与结果区)**:
    *   **算法选择器**: 用户点击切换分析引擎，下方结果区动态更新。
    *   **颜色格式切换条**: 控制下方所有颜色值的显示格式和复制格式。
    *   **结果展示区**: 根据算法和格式，动态渲染调色板。色块点击即可复制当前格式的颜色值。
    *   **手动取色面板**: 可折叠，在点击图片后展开，显示精确取色的放大镜预览和详细颜色信息。

## 5. 开发步骤

```mermaid
graph TD
    subgraph "规划阶段"
        A[需求分析与方案设计] --> B(编写设计文档);
    end
    subgraph "准备阶段"
        B --> C{创建文件结构与 Pinia Store};
        C --> D{添加 `color-thief-ts`, `node-vibrant`, `fast-average-color` 依赖};
    end
    subgraph "核心实现"
        D --> E{实现图片上传与资产注册流程};
        E --> F{开发 `useColorExtractor` 封装三种算法, 输入为 asset URI};
        F --> G{开发主界面 `ColorPicker.vue`, 复用通用组件};
    end
    subgraph "功能集成"
        G --> H{实现分析结果与历史记录存储};
        H --> I{开发历史记录弹窗 `HistoryDialog.vue`};
    end
    subgraph "收尾"
        I --> J{将工具注册到主侧边栏};
        J --> K[完成并测试];
    end