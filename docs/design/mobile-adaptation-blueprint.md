# AIO Hub 移动端适配蓝图 (Mobile Adaptation Blueprint)

本蓝图旨在通过 **“物理隔离”** 与 **“逻辑重构”** 的策略，将 AIO Hub 核心功能（LLM Chat）适配至移动端。移动端将作为一个独立的子项目存在，与桌面端共享核心业务逻辑，但拥有完全独立的 UI 与后端实现。

## 1. 核心架构：独立子项目 (Independent Sub-project)

移动端与桌面端在系统权限、交互习惯、性能瓶颈及 API 行为上存在巨大差异。为了保证桌面端的稳定性并降低移动端的开发复杂度，采用 **“目录级隔离，逻辑级复用”** 的方案。

### 1.1. 项目目录结构

```text
all-in-one-tools/
├── mobile/                    # 移动端独立项目 (全新 Tauri v2 Mobile 项目)
│   ├── src/                   # 移动端前端源码 (Vue 3 + Varlet/移动端专用 UI)
│   │   ├── main.ts
│   │   ├── App.vue
│   │   ├── logic/             # 针对移动端重写的逻辑 (Storage, Assets)
│   │   ├── components/        # 移动端 UI 组件 (适配触摸与软键盘)
│   │   └── tools/             # 移动端重写的工具视图 (如 Chat)
│   ├── src-tauri/             # 移动端后端 (全新 Rust 项目，仅包含移动端必要功能)
│   ├── package.json           # 移动端独立依赖
│   ├── vite.config.ts         # 移动端构建配置
│   └── index.html             # 移动端入口模板
├── src/                       # 桌面端前端源码 (保持现状)
├── src-tauri/                 # 桌面端后端 (保持现状)
├── package.json               # 根目录 Workspace 配置
└── ...
```

### 1.2. 代码复用策略 (Shared Logic)

虽然 UI 和后端完全独立，但核心业务逻辑应当复用以保持功能一致性：

- **复用部分**: LLM API 封装 (`src/llm-apis/`)、宏引擎核心 (`src/tools/llm-chat/core/`)、公共类型定义 (`src/types/`)。
- **重写部分**:
  - **UI 层**: 放弃 Element Plus，改用更具设计感、支持 MD3 的组件库 **Varlet**。
  - **存储层**: 移动端需适配沙盒文件系统，重写 `useChatStorage`。
  - **资产管理**: 重写 `useAssetManager`，移除 Windows 路径依赖，适配移动端协议。
  - **后端**: 移动端 `src-tauri` 仅实现必需的插件（如 `fs`, `http`, `dialog`）和少量核心 Command。

## 2. UI 架构与导航设计 (UI Architecture)

移动端采用 **“工具箱 (Toolbox) + AI 枢纽 (AI Hub)”** 的混合设计，视觉风格对齐桌面端的 **“设计 IDE”** 质感，利用 Varlet 的 MD3 架构实现高信息密度。

### 2.1. 底部导航 (Tabbar) 结构

采用三段式底部导航，强化 Chat 入口：

1.  **首页 (Home)**:
    - **定位**: 效率工具箱。
    - **内容**: 搜索框、最近使用、分类工具网格（网格布局，参考一个木函）。
2.  **Chat (核心入口)**:
    - **定位**: 全局 AI 调度中心。
    - **视觉**: 位于底部中心，采用突出设计的圆形按钮或大图标，强调其作为“重型功能”的地位。
    - **交互**: 点击直接进入最近的会话或 Agent 选择界面。
3.  **设置 (Settings)**:
    - **定位**: 个人配置中心。
    - **内容**: 模型配置、主题外观、关于应用。

### 2.2. 前端交互适配

- **首页 (Home View)**:
  - 采用 **Grid 布局** 展示工具图标，支持长按排序。
  - 顶部固定搜索栏，支持模糊匹配工具名称。
- **Chat 适配**:
  - 针对软键盘优化消息输入框，支持自动避让。
  - 消息气泡长按唤起操作菜单（复制、重试、删除），代替桌面端的悬停按钮。
- **编辑器**: 弃用 `Monaco Editor`，改用轻量级的 `CodeMirror` 或原生文本域。

## 3. 核心功能适配重点

### 3.1. 后端 (Rust) 策略

- **完全解耦**: 移动端后端不继承桌面端的任何代码，从零构建极简的 `mobile/src-tauri`。
- **按需引入**: 仅引入移动端支持的插件，彻底杜绝 `rdev` (全局监听)、`window-vibrancy` (窗口特效) 等桌面端重度依赖。

## 3. 实施路线图

### 第一阶段：环境初始化 (Current)

1.  建立 `mobile/` 目录，初始化 Tauri v2 移动端模板。
2.  配置根目录 Bun Workspace，实现 `mobile` 目录的依赖隔离。
3.  调通 Android/iOS 的基础编译与运行流程。

### 第二阶段：核心逻辑桥接

1.  直接复制公共逻辑代码到 `mobile/src` 目录下，避免引用依赖。
2.  在移动端后端实现基础的文件读写与网络转发 Command。

### 第三阶段：UI 迁移与重构

1.  基于移动端 UI 库重写 LLM Chat 界面。
2.  实现移动端专用的消息列表滚动优化与软键盘避让逻辑。

### 第四阶段：功能收敛

1.  搬运并适配宏引擎，确保桌面端配置的 Prompt 宏在移动端可用。
2.  完成移动端资产管理器的初步实现，支持图片/文件的基础预览。

---

_注：移动端开发应遵循“轻量、触控优先”原则，非核心功能（如 Git 分析、复杂图谱）在移动端暂不实现。_
