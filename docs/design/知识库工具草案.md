# ğŸ“ AIO çŸ¥è¯†åº“è®¾è®¡æ–¹æ¡ˆ (Full Specification)

## ä¸€ã€å±‚çº§æ€»è§ˆ (Architecture Overview)

æ•´ä¸ªçŸ¥è¯†å¼•æ“ç”±ä¸‰ä¸ªæ ¸å¿ƒå±‚çº§ç»„æˆï¼Œè‡ªä¸Šè€Œä¸‹ç®¡ç†çŸ¥è¯†çš„ç»„ç»‡ã€å­˜å‚¨ä¸æ£€ç´¢ã€‚

```mermaid
graph TD
    WS[KnowledgeWorkspace<br/>å…¨å±€å·¥ä½œåŒº] -->|åŒ…å«| KB_List[KnowledgeBase Index<br/>çŸ¥è¯†åº“ç´¢å¼•åˆ—è¡¨]
    WS -->|åŒ…å«| WC[WorkspaceConfig<br/>å…¨å±€é…ç½®]

    KB_List -.->|æ‡’åŠ è½½| KB[KnowledgeBase<br/>çŸ¥è¯†åº“å®ä½“]
    KB -->|åŒ…å«| CAIU[CAIU<br/>åŸå­ä¿¡æ¯å•å…ƒ]

    subgraph Runtime [Rust è¿è¡Œæ—¶å†…å­˜]
        RI[RuntimeIndex<br/>å…¨å±€è¿è¡Œæ—¶ç´¢å¼•]
        RI -->|Tagå€’æ’| TagMap[Tag -> CAIU_ID]
        RI -->|Keyæ˜ å°„| KeyMap[Key -> CAIU_ID]
        RI -->|å¼•ç”¨å›¾ç¼“å­˜| RefCache[Reference Graph Cache]
        RI -->|å‘é‡æ£€ç´¢| VectorIndex[HNSW Index]
    end

    subgraph External [å¤–éƒ¨ä¾èµ–]
        AM[AssetManager<br/>å…¨å±€èµ„äº§ç®¡ç†å™¨]
    end

    CAIU -.->|èµ„äº§å¼•ç”¨| AM
```

---

## äºŒã€Rust æ•°æ®ç»“æ„å®šä¹‰ (Rust Implementation)

ä¸ºäº†å…¼é¡¾å¼€å‘ä½“éªŒä¸è¿è¡Œæ•ˆç‡ï¼Œç³»ç»Ÿä½¿ç”¨ `serde` è¿›è¡Œåºåˆ—åŒ–å¤„ç†ï¼Œå¹¶é‡‡ç”¨ `Uuid` ä½œä¸ºå”¯ä¸€æ ‡è¯†ã€‚

### 2.1 å…¨å±€å·¥ä½œåŒº (Workspace)

```rust
use serde::{Serialize, Deserialize};
use uuid::Uuid;
use std::collections::HashMap;

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct KnowledgeWorkspace {
    pub version: String,
    pub config: WorkspaceConfig,
    pub bases: Vec<KnowledgeBaseIndex>,
}

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct WorkspaceConfig {
    pub default_embedding_model: String,
    pub vector_index: VectorIndexConfig,
}

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct VectorIndexConfig {
    /// ç´¢å¼•ç®—æ³•: "hnsw", "flat", "ivf" ç­‰
    pub algorithm: String,
    /// å‘é‡ç»´åº¦ï¼Œéœ€ä¸ embedding model è¾“å‡ºåŒ¹é…
    pub dimension: usize,
    /// è·ç¦»åº¦é‡: "cosine", "euclidean", "dot"
    pub metric: String,
    /// HNSW ç‰¹å®šå‚æ•°: æ„å»ºæ—¶çš„é‚»å±…æ•°é‡
    pub ef_construction: Option<usize>,
    /// HNSW ç‰¹å®šå‚æ•°: æ¯ä¸ªèŠ‚ç‚¹çš„æœ€å¤§è¿æ¥æ•°
    pub m: Option<usize>,
}

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct KnowledgeBaseIndex {
    pub id: Uuid,
    pub name: String,
    pub description: Option<String>,
    pub entry_count: usize,
    pub last_updated: i64,
    pub path: String, // ç›¸å¯¹è·¯å¾„

    // è¿è¡Œæ—¶çŠ¶æ€ (ä¸åºåˆ—åŒ–åˆ° JSON)
    #[serde(skip)]
    pub is_loaded: bool,
    #[serde(skip)]
    pub is_vectorized: bool,
}
```

### 2.2 çŸ¥è¯†åº“ (KnowledgeBase)

**æ³¨æ„**ï¼šå¯¹äºå¤§å‹æ–‡æœ¬å†…å®¹ï¼Œåœ¨ååºåˆ—åŒ–æ—¶å»ºè®®ä½¿ç”¨ `std::borrow::Cow` ä»¥å‡å°‘å†…å­˜å¤åˆ¶ã€‚

```rust
#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct KnowledgeBase {
    pub id: Uuid,
    pub name: String,
    pub description: Option<String>,

    pub schema_version: String,
    pub content_version: u64,

    pub embedding: EmbeddingConfig,
    pub meta: KnowledgeBaseMeta,

    pub entries: Vec<Caiu>,
}

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct EmbeddingConfig {
    /// ä½¿ç”¨çš„ embedding æ¨¡å‹æ ‡è¯†
    pub model: String,
    /// å‘é‡ç»´åº¦
    pub dimension: usize,
    /// æ‰¹å¤„ç†å¤§å°
    pub batch_size: usize,
    /// æ˜¯å¦å·²å®Œæˆå‘é‡åŒ–
    pub is_indexed: bool,
    /// æœ€åå‘é‡åŒ–æ—¶é—´æˆ³
    pub last_indexed_at: Option<i64>,
}

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct KnowledgeBaseMeta {
    pub created_at: i64,
    pub updated_at: i64,
    pub author: Option<String>,
    /// çŸ¥è¯†åº“çº§åˆ«çš„æ ‡ç­¾ï¼Œç”¨äºåˆ†ç±»
    pub tags: Vec<String>,
    /// çŸ¥è¯†åº“å›¾æ ‡ (Asset ID)
    pub icon: Option<String>,
}

#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct Caiu {
    pub id: Uuid,
    pub key: String,         // ç”¨äº [[Key]] å¼•ç”¨
    pub content: String,     // Markdown å†…å®¹

    /// æ ¸å¿ƒæ ‡ç­¾ (äº«æœ‰æƒé‡åŠ æˆ + å™ªéŸ³è±å…)
    #[serde(default)]
    pub core_tags: Vec<String>,

    /// æ™®é€šæ ‡ç­¾ (ç”¨äºè¾…åŠ©æ£€ç´¢)
    #[serde(default)]
    pub tags: Vec<String>,

    #[serde(default)]
    pub assets: Vec<AssetRef>,

    #[serde(default = "default_priority")]
    pub priority: i32,

    #[serde(default = "default_enabled")]
    pub enabled: bool,

    // è¿è¡Œæ—¶è®¡ç®—çš„å¼•ç”¨å…³ç³» (ä¸æŒä¹…åŒ–ï¼Œé€šè¿‡å†…å­˜ç¼“å­˜ç»´æŠ¤)
    #[serde(skip)]
    pub refs: Vec<Uuid>,     // æœ¬æ¡ç›®å¼•ç”¨çš„å…¶ä»–æ¡ç›®
    #[serde(skip)]
    pub ref_by: Vec<Uuid>,   // å¼•ç”¨æœ¬æ¡ç›®çš„å…¶ä»–æ¡ç›®
}

/// èµ„äº§å¼•ç”¨ç»“æ„ï¼ŒæŒ‡å‘å…¨å±€ AssetManager ä¸­çš„èµ„äº§
#[derive(Debug, Clone, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct AssetRef {
    /// AssetManager ä¸­çš„èµ„äº§ ID
    pub id: String,
    /// æ˜¾ç¤ºåç§°
    pub name: String,
    /// MIME ç±»å‹
    pub mime_type: String,
    /// åè®®å‰ç¼€ï¼Œåº”ä¸º "appdata://"
    pub protocol: String,
}

fn default_priority() -> i32 { 100 }
fn default_enabled() -> bool { true }
```

### 2.3 äº¤äº’æ•°æ®ç»“æ„

```rust
/// åˆ›å»º/æ›´æ–° CAIU çš„è¾“å…¥ç»“æ„
#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct CaiuInput {
    pub key: String,
    pub content: String,
    /// æ ¸å¿ƒæ ‡ç­¾ (äº«æœ‰æƒé‡åŠ æˆ)
    #[serde(default)]
    pub core_tags: Vec<String>,
    /// æ™®é€šæ ‡ç­¾
    #[serde(default)]
    pub tags: Vec<String>,
    /// Asset IDs (æ¥è‡ª AssetManager)
    pub asset_ids: Vec<String>,
    pub priority: Option<i32>,
}

/// æœç´¢è¿‡æ»¤å™¨
#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct SearchFilters {
    /// é™å®šæœç´¢çš„çŸ¥è¯†åº“ ID åˆ—è¡¨ï¼ŒNone è¡¨ç¤ºæœç´¢æ‰€æœ‰
    pub kb_ids: Option<Vec<Uuid>>,
    /// æ ‡ç­¾è¿‡æ»¤
    pub tags: Option<Vec<String>>,
    /// æœ€ä½ç›¸å…³åº¦åˆ†æ•°é˜ˆå€¼ (0.0 - 1.0)
    pub min_score: Option<f32>,
    /// è¿”å›ç»“æœæ•°é‡ä¸Šé™
    pub limit: usize,
    /// æ˜¯å¦åŒ…å«ç¦ç”¨çš„æ¡ç›®
    pub include_disabled: bool,
}

/// æœç´¢ç»“æœ
#[derive(Debug, Serialize, Deserialize)]
#[serde(rename_all = "camelCase")]
pub struct SearchResult {
    /// å‘½ä¸­çš„ CAIU
    pub caiu: Caiu,
    /// ç›¸å…³åº¦åˆ†æ•° (0.0 - 1.0)
    pub score: f32,
    /// åŒ¹é…ç±»å‹: "semantic", "keyword", "hybrid"
    pub match_type: String,
    /// é«˜äº®ç‰‡æ®µ (ç”¨äº UI å±•ç¤º)
    pub highlight: Option<String>,
    /// æ‰€å±çŸ¥è¯†åº“ ID
    pub kb_id: Uuid,
    /// æ‰€å±çŸ¥è¯†åº“åç§°
    pub kb_name: String,
}
```

---

## ä¸‰ã€å…³é”®æŠ€æœ¯æ–¹æ¡ˆ

### 3.1 JSON è§£ææ€§èƒ½ä¼˜åŒ–ç­–ç•¥

ä¸ºç¡®ä¿ Rust ç«¯é«˜æ•ˆè§£æå¤§å‹ JSON ç»“æ„ï¼Œé‡‡ç”¨ä»¥ä¸‹æŠ€æœ¯ç­–ç•¥ï¼š

1.  **æµå¼è¯»å– (Streaming IO)**:
    ä½¿ç”¨ `BufReader` é…åˆ `serde_json::from_reader` æ›¿ä»£ `fs::read_to_string`ï¼Œä»¥æ˜¾è‘—é™ä½å³°å€¼å†…å­˜å ç”¨ã€‚

    ```rust
    let file = File::open("path/to/large_kb.json")?;
    let reader = BufReader::new(file);
    let kb: KnowledgeBase = serde_json::from_reader(reader)?;
    ```

2.  **å¹¶è¡ŒåŠ è½½ (Parallel Loading)**:
    åˆ©ç”¨ `rayon` åº“å¹¶è¡ŒåŠ è½½å’Œè§£æ Workspace ä¸­çš„å¤šä¸ªç‹¬ç«‹ KnowledgeBase æ–‡ä»¶ï¼Œç¼©çŸ­å†·å¯åŠ¨æ—¶é—´ã€‚

3.  **å­—ç¬¦ä¸²å»é‡ (String Interning)**:
    å¯¹äº `tags` ç­‰é«˜é¢‘é‡å¤å­—ç¬¦ä¸²ï¼Œåœ¨å†…å­˜ä¸­ä½¿ç”¨ `string_cache` æˆ– `HashSet` è¿›è¡Œå»é‡å­˜å‚¨ï¼Œå‡å°‘å†…å­˜ç¢ç‰‡ã€‚

### 3.2 å¼•ç”¨è§£æä¸ç¼“å­˜æœºåˆ¶

ç³»ç»Ÿæ”¯æŒåŸºäº Wiki é£æ ¼çš„å¼•ç”¨è¯­æ³•ï¼Œé€šè¿‡å‘½åç©ºé—´åŒºåˆ†åº“å†…ä¸è·¨åº“å¼•ç”¨ã€‚ç”±äºå¼•ç”¨è§£æè®¡ç®—æˆæœ¬è¾ƒé«˜ï¼Œç³»ç»Ÿé‡‡ç”¨**å†·å¯åŠ¨æ„å»º + å†…å­˜ç¼“å­˜**ç­–ç•¥ã€‚

#### 1. å¼•ç”¨æ ¼å¼

- **åº“å†…å¼•ç”¨ (`[[Key]]`)**: ä»…åœ¨å½“å‰çŸ¥è¯†åº“ä¸­æŸ¥æ‰¾ `Key`ã€‚
- **è·¨åº“å¼•ç”¨ (`[[LibraryName::Key]]`)**: åœ¨æŒ‡å®šçš„å¤–éƒ¨åº“ `LibraryName` ä¸­æŸ¥æ‰¾ `Key`ã€‚

#### 2. è§£æè§„åˆ™

- è§£æå™¨ä¼˜å…ˆè¯†åˆ«å‘½åç©ºé—´åˆ†éš”ç¬¦ `::`ã€‚
- è‹¥å­˜åœ¨å‘½åç©ºé—´ï¼Œåˆ™åœ¨å¯¹åº”åç§°çš„çŸ¥è¯†åº“ä¸­æ£€ç´¢ Keyã€‚
- è‹¥æ— å‘½åç©ºé—´ï¼Œåˆ™ä¸¥æ ¼é™åˆ¶åœ¨å½“å‰çŸ¥è¯†åº“èŒƒå›´å†…æ£€ç´¢ã€‚
- ä»»æ„ç¯èŠ‚æŸ¥æ‰¾å¤±è´¥ï¼ˆåº“ä¸å­˜åœ¨æˆ– Key ä¸å­˜åœ¨ï¼‰å‡è§†ä¸ºæ–­é“¾ã€‚

#### 3. ç¼“å­˜ç­–ç•¥

1.  **å†·å¯åŠ¨å¼‚æ­¥æ„å»º**:
    - çŸ¥è¯†åº“åŠ è½½å®Œæˆåï¼Œå¯åŠ¨åå°å¼‚æ­¥ä»»åŠ¡ã€‚
    - éå†æ‰€æœ‰ CAIU çš„ `content` å­—æ®µï¼Œæ­£åˆ™æå– `[[...]]` å¼•ç”¨ã€‚
    - æ„å»ºåŒå‘å¼•ç”¨å›¾ (`refs` / `ref_by`) å¹¶å­˜å…¥ `RuntimeIndex`ã€‚

2.  **å†…å­˜ç¼“å­˜ç»´æŠ¤**:
    - è¿è¡Œæ—¶ç›´æ¥ä»å†…å­˜è¯»å–å¼•ç”¨å…³ç³»ã€‚
    - å½“ CAIU å†…å®¹æ›´æ–°æ—¶ï¼Œå¢é‡æ›´æ–°ç›¸å…³çš„å¼•ç”¨è¾¹ã€‚
    - ä¸å°†å¼•ç”¨å…³ç³»åºåˆ—åŒ–åˆ°ç£ç›˜ï¼Œé¿å…æ•°æ®å†—ä½™å’Œä¸€è‡´æ€§é—®é¢˜ã€‚

### 3.3 å‘é‡å­˜å‚¨ä¸æ£€ç´¢ (Vectorization)

ä¸ºäº†åœ¨æœ¬åœ°é«˜æ•ˆè¿è¡Œè¯­ä¹‰æ£€ç´¢ï¼Œç³»ç»Ÿé‡‡ç”¨è½»é‡çº§çš„åµŒå…¥å¼å‘é‡ç´¢å¼•æ–¹æ¡ˆã€‚

#### 1. å­˜å‚¨åˆ†ç¦»

- **å…ƒæ•°æ®ä¸æ–‡æœ¬**: å­˜å‚¨åœ¨ `kb_xxx.json` ä¸­ã€‚
- **å‘é‡æ•°æ®**: å­˜å‚¨åœ¨åŒåçš„ `kb_xxx.vec` äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ ¼å¼ä¸ºï¼š
  ```
  [HEADER: 4 bytes magic + 4 bytes version + 4 bytes dimension + 4 bytes count]
  [VECTORS: count * dimension * 4 bytes (f32)]
  [ID_MAP: count * 16 bytes (UUID)]
  ```
- **HNSW ç´¢å¼•**: å­˜å‚¨åœ¨ `kb_xxx.hnsw` æ–‡ä»¶ä¸­ï¼ˆå¯é€‰ç”¨ `usearch` æˆ– `hnswlib` çš„åºåˆ—åŒ–æ ¼å¼ï¼‰ã€‚

#### 2. å‘é‡åŒ–æµç¨‹

```mermaid
sequenceDiagram
    participant User
    participant Frontend
    participant Rust
    participant LLM_API

    User->>Frontend: è§¦å‘"å‘é‡åŒ–"
    Frontend->>Rust: kb_vectorize(kb_id)
    loop æ¯ä¸ªæœªå‘é‡åŒ–çš„ CAIU
        Rust->>LLM_API: embedding(content)
        LLM_API-->>Rust: Vec<f32>
        Rust->>Rust: å†™å…¥ .vec æ–‡ä»¶
    end
    Rust->>Rust: æ„å»º HNSW ç´¢å¼•
    Rust->>Rust: ä¿å­˜ .hnsw æ–‡ä»¶
    Rust-->>Frontend: å®Œæˆ
```

#### 3. å¢é‡æ›´æ–°ç­–ç•¥

- **æ–°å¢ CAIU**: è®¡ç®— embeddingï¼Œè¿½åŠ åˆ° `.vec` æ–‡ä»¶ï¼Œå¢é‡æ’å…¥ HNSW ç´¢å¼•ã€‚
- **ä¿®æ”¹ CAIU**: é‡æ–°è®¡ç®— embeddingï¼Œæ›´æ–° `.vec` æ–‡ä»¶å¯¹åº”ä½ç½®ï¼ŒHNSW ç´¢å¼•ä¸­åˆ é™¤æ—§å‘é‡å¹¶æ’å…¥æ–°å‘é‡ã€‚
- **åˆ é™¤ CAIU**: æ ‡è®°ä¸ºå·²åˆ é™¤ï¼ˆæ‡’æƒ°åˆ é™¤ï¼‰ï¼Œå®šæœŸæ‰§è¡Œå‹ç¼©é‡å»ºã€‚

#### 4. æ£€ç´¢èåˆç­–ç•¥

æœç´¢æ—¶åŒæ—¶æ‰§è¡Œè¯­ä¹‰æ£€ç´¢å’Œå…³é”®è¯æ£€ç´¢ï¼Œé‡‡ç”¨ RF (Reciprocal Rank Fusion) èåˆç®—æ³•ï¼š

```
score = Î£ 1 / (k + rank_i)
```

å…¶ä¸­ `k` é€šå¸¸å– 60ï¼Œ`rank_i` ä¸ºè¯¥ç»“æœåœ¨ç¬¬ i ä¸ªæ£€ç´¢æ–¹æ³•ä¸­çš„æ’åã€‚

---

## å››ã€é«˜çº§æ£€ç´¢ç­–ç•¥ (Advanced Retrieval)

å€Ÿé‰´è‡ªVCPçš„ TagMemo "æµªæ½®"ç®—æ³•çš„æ ¸å¿ƒè®¾è®¡ç†å¿µï¼Œç³»ç»Ÿå®ç°äº†ä»¥ä¸‹é«˜çº§æ£€ç´¢ç­–ç•¥ï¼Œä»¥æå‡è¯­ä¹‰æ£€ç´¢çš„ç²¾å‡†åº¦ä¸è¾©è¯æ€§ã€‚

### 4.1 æ ‡ç­¾æƒé‡åˆ†çº§ç³»ç»Ÿ

CAIU æ”¯æŒæ ¸å¿ƒæ ‡ç­¾ä¸æ™®é€šæ ‡ç­¾çš„åŒºåˆ†ï¼Œå€Ÿé‰´ TagMemo çš„"æ ¸å¿ƒæ ‡ç­¾ vs æ™®é€šæ ‡ç­¾"è®¾è®¡ï¼š

| ç‰¹æ€§         | æ ¸å¿ƒæ ‡ç­¾ (Core Tags)     | æ™®é€šæ ‡ç­¾ (Other Tags) |
| :----------- | :----------------------- | :-------------------- |
| **äº§ç”Ÿæ–¹å¼** | æ˜¾å¼æŒ‡å®šæˆ–é¦–è½®å¼ºæ„Ÿåº”     | æ®‹å·®é‡‘å­—å¡”é€å±‚å‰¥ç¦»    |
| **ç¼ºå¤±å¤„ç†** | **è™šæ‹Ÿè¡¥å…¨**ï¼ˆå¼ºè¡Œæå–ï¼‰ | è‡ªåŠ¨å¿½ç•¥              |
| **æƒé‡å¾…é‡** | Core Boost (1.2x-1.4x)   | åŸå§‹è´¡çŒ®æƒé‡          |
| **å™ªéŸ³è¿‡æ»¤** | **å®Œå…¨è±å…**             | ä¸¥æ ¼é—¨æ§ç­›é€‰          |

**æ£€ç´¢æ—¶é€»è¾‘**:

- æ ¸å¿ƒæ ‡ç­¾å‘½ä¸­æ—¶ï¼Œç›¸å…³åº¦åˆ†æ•° Ã— 1.3
- æŸ¥è¯¢ä¸­æ˜¾å¼æåŠçš„æ ‡ç­¾ï¼ˆå¦‚ `#æŠ€æœ¯`ï¼‰è‡ªåŠ¨æå‡ä¸ºæ ¸å¿ƒæ ‡ç­¾
- æ ¸å¿ƒæ ‡ç­¾åœ¨å™ªéŸ³è¿‡æ»¤é˜¶æ®µäº«æœ‰è±å…æƒ

### 4.2 æ®‹å·®é‡‘å­—å¡” (è¯­ä¹‰èƒ½é‡åˆ†è§£)

å€Ÿé‰´ TagMemo çš„æ®‹å·®é‡‘å­—å¡”æœºåˆ¶ï¼Œå®ç°å¤šçº§è¯­ä¹‰èƒ½é‡åˆ†è§£ï¼š

```mermaid
sequenceDiagram
    participant Q as æŸ¥è¯¢å‘é‡
    participant L1 as ç¬¬ä¸€è½®æ£€ç´¢
    participant R as æ®‹å·®è®¡ç®—
    participant L2 as ç¬¬äºŒè½®æ£€ç´¢
    participant F as ç»“æœèåˆ

    Q->>L1: åŸå§‹å‘é‡æ£€ç´¢ (Top-5)
    L1->>R: è®¡ç®—æ®‹å·®å‘é‡ (Gram-Schmidt æ­£äº¤æŠ•å½±)
    R->>L2: æ®‹å·®å‘é‡æ£€ç´¢ (Top-5)
    L2->>F: åŠ æƒèåˆç»“æœ
```

**æ ¸å¿ƒç®—æ³•**:

```rust
/// æ®‹å·®é‡‘å­—å¡”æ£€ç´¢
pub fn pyramid_search(query_vec: &[f32], index: &HnswIndex, depth: usize) -> Vec<SearchResult> {
    let mut results = Vec::new();
    let mut current_vec = query_vec.to_vec();
    let mut explained_energy = 0.0;

    for level in 0..depth {
        if explained_energy > 0.9 { break; } // 90% èƒ½é‡é˜ˆå€¼

        let level_results = index.search(&current_vec, 5);
        let weight = 1.0 / (level + 1) as f32; // å±‚çº§è¡°å‡

        for r in level_results {
            results.push(r.with_weight(weight));
            // è®¡ç®—æ®‹å·®ï¼šå»é™¤å·²åŒ¹é…çš„è¯­ä¹‰æˆåˆ†
            current_vec = orthogonal_residual(&current_vec, &r.vector);
            explained_energy += r.contribution;
        }
    }

    deduplicate_and_rank(results)
}
```

**ä¼˜åŠ¿**:

- é¿å…å•ä¸€å…³é”®è¯ä¸»å¯¼æ£€ç´¢ç»“æœ
- æ•è·è¢«å®è§‚æ¦‚å¿µæ©ç›–çš„**å¾®å¼±ä¿¡å·**
- ç›´åˆ° 90% çš„è¯­ä¹‰èƒ½é‡è¢«è§£é‡Šä¸ºæ­¢

### 4.3 è¾©è¯æ£€ç´¢ (åæŒ¯è¯­ä¹‰èˆµ PSR)

å€Ÿé‰´ TagMemo V4 çš„"åæŒ¯è¯­ä¹‰èˆµ"æœºåˆ¶ï¼Œå®ç°è¾©è¯è®¤çŸ¥æ£€ç´¢ï¼š

**åæŒ¯æ£€æµ‹**:

```rust
const HESITATION_MARKERS: &[&str] = &[
    "è™½ç„¶", "ä½†æ˜¯", "ä¸è¿‡", "ç„¶è€Œ", "å¯æ˜¯",
    "ä¸€æ–¹é¢", "å¦ä¸€æ–¹é¢", "æˆ–è®¸", "ä¹Ÿè®¸",
    "æ˜¯è¿™æ ·...ä½†å¦‚æœ", "è™½ç„¶...ä½†æ˜¯"
];

/// åæŒ¯æ£€æµ‹ç»“æœ
#[derive(Debug)]
pub struct PolarizationAnalysis {
    /// åæŒ¯å¼ºåº¦ (0.0 - 1.0)
    pub intensity: f32,
    /// æ£€æµ‹åˆ°çš„è½¬æŠ˜è¯
    pub markers: Vec<String>,
    /// å»ºè®®çš„å¯¹å†²æ–¹å‘
    pub hedge_direction: Option<String>,
}

fn detect_polarization(text: &str) -> PolarizationAnalysis {
    let markers: Vec<String> = HESITATION_MARKERS
        .iter()
        .filter(|m| text.contains(*m))
        .map(|s| s.to_string())
        .collect();

    let intensity = (markers.len() as f32 / 3.0).min(1.0);

    PolarizationAnalysis {
        intensity,
        markers,
        hedge_direction: if intensity > 0.3 { Some("opposite".into()) } else { None },
    }
}
```

**è¾©è¯æ£€ç´¢æµç¨‹**:

1. æ£€æµ‹æŸ¥è¯¢æ–‡æœ¬çš„åæŒ¯åº¦
2. å¦‚æœåæŒ¯åº¦ > é˜ˆå€¼ (é»˜è®¤ 0.3)ï¼ŒåŒæ—¶æ‰§è¡Œï¼š
   - **ä¸»æ£€ç´¢**: æ­£å¸¸è¯­ä¹‰æ£€ç´¢
   - **å¯¹å†²æ£€ç´¢**: ä½¿ç”¨"è´Ÿå‘"å…³é”®è¯æˆ–å¯¹ç«‹é¢†åŸŸ
3. æŒ‰æ¯”ä¾‹èåˆç»“æœï¼ˆå¦‚ 70% ä¸»æ£€ç´¢ + 30% å¯¹å†²ï¼‰

**ä¼˜åŠ¿**:

- æ‰“ç ´"å›å£°å£å’"ï¼Œæä¾›å¹³è¡¡è§†è§’
- å½“ç”¨æˆ·è¡¨è¾¾çŠ¹è±«/çŸ›ç›¾æ—¶ï¼Œä¸»åŠ¨æä¾›å¯¹ç«‹è§‚ç‚¹
- å®ç°çœŸæ­£çš„è¾©è¯è®¤çŸ¥ï¼Œè€Œéå•å‘ä¿¡æ¯çŒè¾“

### 4.4 åŠ¨æ€æ£€ç´¢å‚æ•° (Beta å…¬å¼)

å€Ÿé‰´ TagMemo çš„åŠ¨æ€ Beta å…¬å¼ï¼Œæ ¹æ®æŸ¥è¯¢æ„å›¾è‡ªåŠ¨è°ƒæ•´æ£€ç´¢å‚æ•°ï¼š

```rust
/// æŸ¥è¯¢æ„å›¾åˆ†æç»“æœ
#[derive(Debug)]
pub struct QueryIntent {
    /// é€»è¾‘æ·±åº¦ (0.0 - 1.0)ï¼Œè¶Šé«˜è¡¨ç¤ºæ„å›¾è¶Šèšç„¦
    pub logic_depth: f32,
    /// å…±æŒ¯å€¼ï¼šæ˜¯å¦è§¦åŠå¤šä¸ªè¯­ä¹‰è½´
    pub resonance: f32,
    /// å™ªéŸ³æƒ©ç½š
    pub noise_penalty: f32,
}

impl QueryIntent {
    /// è®¡ç®—åŠ¨æ€ Beta å€¼ (æ ‡ç­¾å¢å¼ºç³»æ•°)
    pub fn compute_beta(&self) -> f32 {
        // Î² = Ïƒ(L Â· log(1 + R) - S Â· noise_penalty)
        let raw = self.logic_depth * (1.0 + self.resonance).ln()
                - self.noise_penalty * 0.5;
        sigmoid(raw).clamp(0.1, 0.9)
    }

    /// è®¡ç®—åŠ¨æ€ K å€¼ (æ£€ç´¢æ•°é‡)
    pub fn compute_k(&self) -> usize {
        let base_k = 10;
        let boost = (self.logic_depth * 5.0) as usize;
        (base_k + boost).min(30)
    }
}
```

**åŠ¨æ€è°ƒæ•´é€»è¾‘**:

- **æ„å›¾æ˜ç¡®** (é€»è¾‘æ·±åº¦é«˜): åŠ å¤§æ ‡ç­¾å¢å¼ºï¼Œæ‰©å¤§æ£€ç´¢èŒƒå›´
- **å™ªéŸ³è¾ƒå¤š** (å™ªéŸ³æƒ©ç½šé«˜): æ”¶ç´§å¢å¼ºï¼Œå›å½’ç¨³å¥æ£€ç´¢
- **è·¨åŸŸå…±æŒ¯** (å…±æŒ¯å€¼é«˜): é€‚å½“æ‰©å¤§æ£€ç´¢å¹¿åº¦

### 4.5 é¢†åŸŸé—¨æ§ (Worldview Gating)

å€Ÿé‰´ TagMemo çš„ EPA æ¨¡å—ä¸–ç•Œè§‚é—¨æ§ï¼Œåœ¨ CAIU çº§åˆ«å¢åŠ é¢†åŸŸåˆ†ç±»ï¼š

```rust
#[derive(Debug, Serialize, Deserialize, Clone, Copy)]
pub enum KnowledgeDomain {
    Technical,      // æŠ€æœ¯/ä»£ç 
    Creative,       // åˆ›æ„/å†™ä½œ
    Factual,        // äº‹å®æ€§çŸ¥è¯†
    Emotional,      // æƒ…æ„Ÿ/å¯¹è¯
    WorldSetting,   // ä¸–ç•Œè§‚è®¾å®š (è§’è‰²æ‰®æ¼”)
    Procedural,     // æµç¨‹/æ“ä½œæŒ‡å—
}

#[derive(Debug, Serialize, Deserialize)]
pub struct Caiu {
    // ... å…¶ä»–å­—æ®µ

    /// æ‰€å±é¢†åŸŸ (ç”¨äºé—¨æ§è¿‡æ»¤)
    #[serde(default)]
    pub domain: Option<KnowledgeDomain>,
}
```

**æ£€ç´¢æ—¶é€»è¾‘**:

- æ ¹æ®æŸ¥è¯¢æ„å›¾è‡ªåŠ¨æ¨æ–­ç›®æ ‡é¢†åŸŸ
- ä¼˜å…ˆè¿”å›é¢†åŸŸåŒ¹é…çš„ç»“æœ
- æ”¯æŒè·¨é¢†åŸŸæ£€ç´¢ï¼ˆå½“å…±æŒ¯å€¼é«˜æ—¶ï¼‰

---

## äº”ã€æ–‡ä»¶å­˜å‚¨ç»“æ„ç¤ºä¾‹

```text
e:/rc20/allinweb/all-in-one-tools/knowledge/
â”œâ”€â”€ workspace.json              # å…¥å£æ–‡ä»¶
â””â”€â”€ bases/                      # çŸ¥è¯†åº“æ•°æ®ç›®å½•
    â”œâ”€â”€ kb_personal.json        # çŸ¥è¯†åº“å…ƒæ•°æ®ä¸æ–‡æœ¬
    â”œâ”€â”€ kb_personal.vec         # å‘é‡æ•°æ®
    â”œâ”€â”€ kb_personal.hnsw        # HNSW ç´¢å¼•
    â”œâ”€â”€ kb_world_setting.json
    â”œâ”€â”€ kb_world_setting.vec
    â”œâ”€â”€ kb_world_setting.hnsw
    â”œâ”€â”€ kb_coding.json
    â”œâ”€â”€ kb_coding.vec
    â””â”€â”€ kb_coding.hnsw
```

> **æ³¨æ„**: å¤šæ¨¡æ€èµ„äº§ï¼ˆå›¾ç‰‡ã€éŸ³é¢‘ç­‰ï¼‰ç»Ÿä¸€å­˜å‚¨åœ¨å…¨å±€ `AssetManager` ç®¡ç†çš„ç›®å½•ä¸­ï¼Œé€šè¿‡ `appdata://` åè®®å¼•ç”¨ï¼Œä¸åœ¨çŸ¥è¯†åº“ç›®å½•ä¸‹ç‹¬ç«‹å­˜å‚¨ã€‚

---

## å…­ã€Chat é›†æˆæ–¹æ¡ˆ (Pipeline Integration)

åŸºäº LLM Chat çš„ **Unified Pipeline Architecture**ï¼ŒçŸ¥è¯†å¼•æ“å°†ä½œä¸ºæ ‡å‡†çš„ **ContextProcessor** æ¥å…¥ã€‚

### 6.1 å¤„ç†å™¨å®šä¹‰

æ–°å¢ `knowledge-retriever` å¤„ç†å™¨ï¼Œæ’å…¥åˆ°ä¸Šä¸‹æ–‡ç®¡é“çš„ä¸­æ®µã€‚

| å±æ€§         | å€¼                    | è¯´æ˜                                                    |
| :----------- | :-------------------- | :------------------------------------------------------ |
| **ID**       | `knowledge-retriever` | å”¯ä¸€æ ‡è¯†ç¬¦                                              |
| **Priority** | **350** (é»˜è®¤å€¼)      | ä½äº `transcription` ä¹‹åï¼Œ`injection` ä¹‹å‰ï¼Œå¯é…ç½®è°ƒæ•´ |
| **Role**     | RAG æ£€ç´¢ä¸æ³¨å…¥        | åˆ†æå½“å‰ä¸Šä¸‹æ–‡ï¼Œæ£€ç´¢çŸ¥è¯†ï¼Œæ³¨å…¥ System Message           |

**æ‰§è¡Œé€»è¾‘**:

1.  **Input**: æ¥æ”¶ `PipelineContext`ï¼Œè·å–æœ€è¿‘çš„ç”¨æˆ·æ¶ˆæ¯ï¼ˆåŒ…æ‹¬å·²è½¬å†™çš„éŸ³é¢‘/å›¾ç‰‡æ–‡æœ¬ï¼‰ã€‚
2.  **Search**: è°ƒç”¨ Rust åç«¯ `kb_search` æ¥å£ï¼Œæ‰§è¡Œè¯­ä¹‰æ£€ç´¢ + å…³é”®è¯åŒ¹é…ã€‚
3.  **Inject**: å°†å‘½ä¸­çš„ CAIU (åŸå­ä¿¡æ¯å•å…ƒ) æ ¼å¼åŒ–ä¸º System Messageï¼Œæ’å…¥åˆ° `context.messages` å¤´éƒ¨ã€‚
    - _ä¼˜åŠ¿_: ç”±äºåœ¨ `token-limiter` ä¹‹å‰æ‰§è¡Œï¼ŒToken é™åˆ¶å™¨ä¼šè‡ªåŠ¨è®¡ç®—çŸ¥è¯†çš„å¼€é”€ï¼Œå¹¶ä¼˜å…ˆæˆªæ–­è¾ƒæ—©çš„ä¼šè¯å†å²ï¼Œç¡®ä¿çŸ¥è¯†ä¸Šä¸‹æ–‡ä¸è¢«ä¸¢å¼ƒã€‚

### 6.2 å¤šæ¨¡æ€èµ„äº§æ³¨å…¥ (Structured Injection)

LLM Chat çš„ `asset-resolver` å¤„ç†å™¨ä¸è§£ææ¶ˆæ¯æ–‡æœ¬ä¸­çš„åè®®ï¼Œå®ƒå¤„ç†çš„æ˜¯ `ChatMessageNode.attachments` å­—æ®µä¸­çš„ç»“æ„åŒ–é™„ä»¶åˆ—è¡¨ã€‚å› æ­¤ï¼ŒçŸ¥è¯†åº“ä¸­çš„å¤šæ¨¡æ€å†…å®¹å¿…é¡»é€šè¿‡ç»“æ„åŒ–æ–¹å¼æ³¨å…¥ã€‚

**å¤„ç†æµç¨‹**:

1.  **æ£€ç´¢ç»“æœç»“æ„åŒ–**: `SearchResult.caiu.assets` å­—æ®µåŒ…å«å®Œæ•´çš„ `AssetRef` åˆ—è¡¨ã€‚

2.  **æ„å»ºæ³¨å…¥æ¶ˆæ¯**: `knowledge-retriever` å¤„ç†å™¨åœ¨æ„å»ºæ³¨å…¥æ¶ˆæ¯æ—¶ï¼Œå°† `AssetRef` è½¬æ¢ä¸ºæ ‡å‡†çš„ `ChatMessageNode` é™„ä»¶æ ¼å¼ï¼š

    ```typescript
    const injectedMessage: ChatMessageNode = {
      role: "system",
      content: caiu.content, // çº¯æ–‡æœ¬/Markdown å†…å®¹
      attachments: caiu.assets.map((assetRef) => ({
        id: assetRef.id,
        name: assetRef.name,
        mimeType: assetRef.mime_type,
        // ... å…¶ä»– Asset å…ƒæ•°æ®
      })),
    };
    ```

3.  **åç»­å¤„ç†**:
    - å¦‚æœæ¨¡å‹æ”¯æŒè§†è§‰ï¼Œ`asset-resolver` ä¼šå°† `attachments` ä¸­çš„å›¾ç‰‡è½¬æ¢ä¸º Base64 æˆ– URLã€‚
    - å¦‚æœæ¨¡å‹ä¸æ”¯æŒè§†è§‰ï¼Œ`transcription-processor` ä¼šå…ˆå¯¹å›¾ç‰‡è¿›è¡Œ OCR è½¬å†™ï¼Œå°†æ–‡æœ¬è¿½åŠ åˆ° `content` ä¸­ã€‚

### 6.3 ç•Œé¢äº¤äº’

- **Agent é…ç½®**: åœ¨ Agent ç¼–è¾‘å™¨çš„ "Pipeline Config" éƒ¨åˆ†ï¼Œå¯ä»¥å¯ç”¨/ç¦ç”¨ `knowledge-retriever`ï¼Œå¹¶ç»‘å®šç‰¹å®šçš„çŸ¥è¯†åº“ï¼ˆå¦‚ "åªæœç´¢ Project A çŸ¥è¯†åº“"ï¼‰ã€‚
- **æ˜¾å¼å¼•ç”¨**: åˆ©ç”¨ **Anchor System**ï¼Œæ³¨å†Œ `knowledge_base` é”šç‚¹ã€‚è¯¥é”šç‚¹ç±»ä¼¼äº `chat_history`ï¼Œä½œä¸ºçŸ¥è¯†æ£€ç´¢ç»“æœçš„æ’å…¥ç‚¹ä½ï¼Œå…è®¸ç”¨æˆ·åœ¨ Prompt Template ä¸­ç²¾ç¡®æ§åˆ¶çŸ¥è¯†å†…å®¹çš„æ’å…¥ä½ç½®ã€‚

---

## ä¸ƒã€å‰ç«¯å·¥å…·æ¶æ„ (Frontend Architecture)

çŸ¥è¯†åº“å·¥å…·ä½œä¸ºç‹¬ç«‹çš„ Tool æ¨¡å—ï¼Œä½äº `src/tools/knowledge-base/` ç›®å½•ä¸‹ã€‚

### 7.1 ç›®å½•ç»“æ„

```text
src/tools/knowledge-base/
â”œâ”€â”€ KnowledgeBase.vue                    # ä¸»å…¥å£ç»„ä»¶
â”œâ”€â”€ knowledge-base.registry.ts           # å·¥å…·æ³¨å†Œæ–‡ä»¶
â”œâ”€â”€ types/                               # ç±»å‹å®šä¹‰
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ caiu.ts                          # CAIU ç›¸å…³ç±»å‹
â”‚   â”œâ”€â”€ knowledge-base.ts                # çŸ¥è¯†åº“ç±»å‹
â”‚   â””â”€â”€ search.ts                        # æœç´¢ç›¸å…³ç±»å‹
â”œâ”€â”€ stores/                              # çŠ¶æ€ç®¡ç†
â”‚   â”œâ”€â”€ knowledgeBaseStore.ts            # ä¸» Store
â”‚   â””â”€â”€ lensStore.ts                     # é€é•œç³»ç»Ÿ Store
â”œâ”€â”€ composables/                         # ç»„åˆå¼å‡½æ•°
â”‚   â”œâ”€â”€ useKnowledgeBase.ts              # çŸ¥è¯†åº“æ“ä½œ
â”‚   â”œâ”€â”€ useCaiuEditor.ts                 # CAIU ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ useKnowledgeSearch.ts            # æœç´¢åŠŸèƒ½
â”‚   â”œâ”€â”€ useReferenceGraph.ts             # å¼•ç”¨å›¾è°±
â”‚   â””â”€â”€ useLensSystem.ts                 # é€é•œç³»ç»Ÿ
â”œâ”€â”€ components/                          # ç»„ä»¶
â”‚   â”œâ”€â”€ KnowledgeBaseList.vue            # çŸ¥è¯†åº“åˆ—è¡¨
â”‚   â”œâ”€â”€ CaiuList.vue                     # CAIU åˆ—è¡¨
â”‚   â”œâ”€â”€ CaiuEditor.vue                   # CAIU ç¼–è¾‘å™¨
â”‚   â”œâ”€â”€ CaiuCard.vue                     # CAIU å¡ç‰‡
â”‚   â”œâ”€â”€ SearchPanel.vue                  # æœç´¢é¢æ¿
â”‚   â”œâ”€â”€ ReferenceGraphView.vue           # å¼•ç”¨å›¾è°±è§†å›¾
â”‚   â”œâ”€â”€ LensPanel.vue                    # é€é•œé¢æ¿
â”‚   â”œâ”€â”€ VectorizationDialog.vue          # å‘é‡åŒ–å¯¹è¯æ¡†
â”‚   â”œâ”€â”€ ImportExportDialog.vue           # å¯¼å…¥å¯¼å‡ºå¯¹è¯æ¡†
â”‚   â””â”€â”€ KnowledgeBaseSettings.vue        # çŸ¥è¯†åº“è®¾ç½®
â””â”€â”€ utils/                               # å·¥å…·å‡½æ•°
    â”œâ”€â”€ markdown.ts                      # Markdown å¤„ç†
    â”œâ”€â”€ reference-parser.ts              # å¼•ç”¨è§£æ
    â””â”€â”€ export.ts                        # å¯¼å‡ºåŠŸèƒ½
```

### 7.2 æ ¸å¿ƒ Store è®¾è®¡

```typescript
// stores/knowledgeBaseStore.ts
import { defineStore } from "pinia";
import { invoke } from "@tauri-apps/api/core";
import type { KnowledgeBase, Caiu, SearchFilters, SearchResult } from "../types";

export const useKnowledgeBaseStore = defineStore("knowledgeBase", {
  state: () => ({
    bases: [] as KnowledgeBaseIndex[],
    activeBaseId: null as string | null,
    entries: [] as Caiu[],
    searchResults: [] as SearchResult[],
    loading: false,
    vectorizing: false,
  }),

  getters: {
    activeBase: (state) => state.bases.find((b) => b.id === state.activeBaseId),
  },

  actions: {
    async loadBases() {
      this.bases = await invoke("kb_list_bases");
    },
    async switchBase(baseId: string) {
      this.activeBaseId = baseId;
      const base = await invoke("kb_get_base", { kbId: baseId });
      this.entries = base.entries;
    },
    async search(query: string, filters: SearchFilters) {
      this.searchResults = await invoke("kb_search", { query, filters });
    },
    async addEntry(content: CaiuInput) {
      const entry = await invoke("kb_add_entry", { kbId: this.activeBaseId, content });
      this.entries.push(entry);
    },
    // ... å…¶ä»– CRUD æ“ä½œ
  },
});
```

---

## å…«ã€é€é•œç³»ç»Ÿ (Lens System)

é€é•œç³»ç»Ÿæ˜¯çŸ¥è¯†åº“çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé€šè¿‡æ ‡ç­¾åŠ¨æ€è¿‡æ»¤å’ŒèšåˆçŸ¥è¯†ã€‚

### 8.1 æ ¸å¿ƒæ¦‚å¿µ

- **é€é•œ (Lens)**: ä¸€ç»„æ ‡ç­¾çš„ç»„åˆï¼Œå®šä¹‰äº†ä¸€ä¸ªçŸ¥è¯†è§†è§’ã€‚
- **é”šç‚¹ (Anchor)**: CAIU ä¸Šçš„æ ‡ç­¾ï¼Œä½œä¸ºé€é•œçš„è¿‡æ»¤ä¾æ®ã€‚

### 8.2 é€é•œ Store

```typescript
export interface Lens {
  id: string;
  name: string;
  tags: string[]; // å¿…é¡»åŒ…å«çš„æ ‡ç­¾ (AND)
  excludeTags?: string[]; // æ’é™¤çš„æ ‡ç­¾ (NOT)
  color?: string;
}

export const useLensStore = defineStore("lens", {
  state: () => ({
    lenses: [] as Lens[],
    activeLensId: null as string | null,
  }),
  // ... CRUD æ“ä½œ
});
```

---

## ä¹ã€ç•Œé¢äº¤äº’è®¾è®¡

### 9.1 ä¸»ç•Œé¢å¸ƒå±€

é‡‡ç”¨ä¸‰æ å¼è®¾è®¡ï¼š

1. **å·¦æ **: çŸ¥è¯†åº“åˆ—è¡¨ã€å…¨å±€æœç´¢ã€å›¾è°±è§†å›¾å…¥å£ã€‚
2. **ä¸­æ **: CAIU åˆ—è¡¨ï¼ˆæ”¯æŒå¡ç‰‡/åˆ—è¡¨åˆ‡æ¢ï¼‰ä¸ Markdown ç¼–è¾‘å™¨ã€‚
3. **å³æ **: é€é•œé¢æ¿ã€æ¡ç›®å¼•ç”¨å…³ç³»å›¾ã€èµ„äº§åº“ã€‚

### 9.2 ç¼–è¾‘å™¨ç‰¹æ€§

- **åŒå‘é“¾æ¥**: è¾“å…¥ `[[` è§¦å‘è¡¥å…¨ï¼Œæ˜¾ç¤ºå·²æœ‰ CAIU çš„ Keyã€‚
- **èµ„äº§é›†æˆ**: æ‹–æ‹½èµ„äº§åˆ°ç¼–è¾‘å™¨ï¼Œè‡ªåŠ¨ç”Ÿæˆ `![name](appdata://asset_id)`ã€‚
- **å¼•ç”¨é¢„è§ˆ**: æ‚¬åœåœ¨å¼•ç”¨é“¾æ¥ä¸Šï¼Œå¼¹å‡º CAIU é¢„è§ˆæµ®çª—ã€‚

---

## åã€åç«¯æ¶æ„ (Backend Architecture)

åœ¨ `src-tauri/src/` ä¸‹æ–°å¢ `knowledge` æ¨¡å—ï¼Œä¿æŒ `lib.rs` æ•´æ´ã€‚

```text
src-tauri/src/knowledge/
â”œâ”€â”€ mod.rs              # æ¨¡å—å…¥å£ä¸ API æ³¨å†Œ
â”œâ”€â”€ core.rs             # æ ¸å¿ƒç»“æ„ä½“ (Workspace, KnowledgeBase, Caiu)
â”œâ”€â”€ index/              # ç´¢å¼•ç›¸å…³
â”‚   â”œâ”€â”€ vector.rs       # å‘é‡å­˜å‚¨ä¸æ£€ç´¢ (HNSW)
â”‚   â”œâ”€â”€ reference.rs    # å¼•ç”¨å…³ç³»å›¾æ„å»ºä¸ç¼“å­˜
â”‚   â””â”€â”€ text.rs         # å…¨æ–‡æ£€ç´¢ (Tantivy æˆ–ç®€å•å€’æ’)
â”œâ”€â”€ io.rs               # æ–‡ä»¶è¯»å†™ä¸æµå¼è§£æ
â””â”€â”€ service.rs          # ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ (ä¾› Command è°ƒç”¨)
```

### 10.1 æ ¸å¿ƒ Command å®šä¹‰

```rust
// æ³¨å†Œåˆ° lib.rs çš„å‘½ä»¤åˆ—è¡¨
#[tauri::command]
fn kb_create_workspace(config: WorkspaceConfig) -> Result<Uuid, String>;

#[tauri::command]
fn kb_list_bases() -> Result<Vec<KnowledgeBaseIndex>, String>;

#[tauri::command]
fn kb_search(query: String, filters: SearchFilters) -> Result<Vec<SearchResult>, String>;

#[tauri::command]
fn kb_add_entry(kb_id: Uuid, content: CaiuInput) -> Result<Caiu, String>;

#[tauri::command]
fn kb_update_entry(kb_id: Uuid, caiu_id: Uuid, content: CaiuInput) -> Result<Caiu, String>;

#[tauri::command]
fn kb_delete_entry(kb_id: Uuid, caiu_id: Uuid) -> Result<(), String>;

#[tauri::command]
fn kb_vectorize(kb_id: Uuid) -> Result<(), String>;

#[tauri::command]
fn kb_get_references(kb_id: Uuid, caiu_id: Uuid) -> Result<ReferenceInfo, String>;
```

---

## åä¸€ã€å®æ–½è·¯çº¿å›¾ (Implementation Roadmap)

æœ¬è·¯çº¿å›¾é‡‡ç”¨**å¹¶è¡Œå¼€å‘ + å¢é‡é›†æˆ**çš„ç­–ç•¥ï¼Œç¡®ä¿å„æ¨¡å—å¯ä»¥ç‹¬ç«‹æ¨è¿›ï¼Œå¹¶å°½æ—©å»ºç«‹å¯æµ‹è¯•çš„é—­ç¯ã€‚

### é˜¶æ®µ 0: åŸºç¡€æ•°æ®å±‚ (Foundation Layer) - ä¼˜å…ˆçº§ï¼šğŸ”´ æœ€é«˜

**ç›®æ ‡**: å»ºç«‹æ•°æ®ç»“æ„ä¸æŒä¹…åŒ–åŸºç¡€ï¼Œä¸ºæ‰€æœ‰åç»­æ¨¡å—æä¾›æ”¯æ’‘ã€‚

**Rust åç«¯**:

- [ ] å®šä¹‰æ ¸å¿ƒæ•°æ®ç»“æ„ (`Workspace`, `KnowledgeBase`, `Caiu`, `AssetRef`)
- [ ] å®ç° JSON åºåˆ—åŒ–/ååºåˆ—åŒ– (ä½¿ç”¨ `serde`)
- [ ] å®ç°æµå¼æ–‡ä»¶ I/O (`BufReader` + `serde_json::from_reader`)
- [ ] ç¼–å†™å•å…ƒæµ‹è¯• (åºåˆ—åŒ–å¾€è¿”æµ‹è¯•ã€å¤§æ–‡ä»¶åŠ è½½æµ‹è¯•)
- [ ] å®ç°åŸºç¡€ Command API:
  - `kb_create_workspace` - åˆ›å»ºå·¥ä½œåŒº
  - `kb_create_base` - åˆ›å»ºçŸ¥è¯†åº“
  - `kb_list_bases` - åˆ—å‡ºçŸ¥è¯†åº“
  - `kb_get_base` - è·å–çŸ¥è¯†åº“è¯¦æƒ…
  - `kb_add_entry` - æ·»åŠ  CAIU
  - `kb_update_entry` - æ›´æ–° CAIU
  - `kb_delete_entry` - åˆ é™¤ CAIU

**å‰ç«¯åŸºç¡€**:

- [ ] å®šä¹‰ TypeScript ç±»å‹ (`types/` ç›®å½•)
- [ ] åˆ›å»º Pinia Store (`knowledgeBaseStore.ts`)
- [ ] å®ç°åŸºç¡€ CRUD æ“ä½œçš„ Store Actions

**éªŒæ”¶æ ‡å‡†**: èƒ½å¤Ÿé€šè¿‡ Rust Command åˆ›å»ºçŸ¥è¯†åº“ã€æ·»åŠ /ç¼–è¾‘/åˆ é™¤ CAIUï¼Œæ•°æ®æ­£ç¡®æŒä¹…åŒ–åˆ° JSON æ–‡ä»¶ã€‚

---

### é˜¶æ®µ 1A: åŸºç¡€ UI æ¡†æ¶ (Parallel Track) - ä¼˜å…ˆçº§ï¼šğŸŸ  é«˜

**ç›®æ ‡**: æ­å»ºå¯ç”¨çš„çŸ¥è¯†åº“ç®¡ç†ç•Œé¢ï¼Œå®ç°åŸºæœ¬çš„ CRUD æ“ä½œã€‚

**å‰ç«¯ç»„ä»¶**:

- [ ] `KnowledgeBase.vue` - ä¸»å…¥å£ç»„ä»¶ (ä¸‰æ å¸ƒå±€æ¡†æ¶)
- [ ] `KnowledgeBaseList.vue` - çŸ¥è¯†åº“åˆ—è¡¨ (å·¦æ )
- [ ] `CaiuList.vue` - CAIU åˆ—è¡¨ (ä¸­æ ï¼Œæ”¯æŒå¡ç‰‡/åˆ—è¡¨åˆ‡æ¢)
- [ ] `CaiuEditor.vue` - CAIU ç¼–è¾‘å™¨ (åŸºäº `RichCodeEditor` æˆ– `PromptEditor`)
- [ ] `KnowledgeBaseSettings.vue` - çŸ¥è¯†åº“è®¾ç½®å¯¹è¯æ¡†

**Composables**:

- [ ] `useKnowledgeBase.ts` - çŸ¥è¯†åº“æ“ä½œé€»è¾‘
- [ ] `useCaiuEditor.ts` - CAIU ç¼–è¾‘å™¨çŠ¶æ€ç®¡ç†

**éªŒæ”¶æ ‡å‡†**: ç”¨æˆ·å¯ä»¥é€šè¿‡ UI åˆ›å»ºçŸ¥è¯†åº“ã€æ·»åŠ /ç¼–è¾‘/åˆ é™¤ CAIUï¼Œç•Œé¢å“åº”æµç•…ã€‚

---

### é˜¶æ®µ 1B: å…³é”®è¯æ£€ç´¢ (Parallel Track) - ä¼˜å…ˆçº§ï¼šğŸŸ  é«˜

**ç›®æ ‡**: å®ç°åŸºç¡€çš„å…³é”®è¯æœç´¢åŠŸèƒ½ï¼Œå»ºç«‹æ£€ç´¢é—­ç¯ã€‚

**Rust åç«¯**:

- [ ] å®ç°ç®€å•çš„å€’æ’ç´¢å¼• (Tag -> CAIU_ID, Key -> CAIU_ID)
- [ ] å®ç°å…³é”®è¯åŒ¹é…ç®—æ³• (æ”¯æŒæ ‡ç­¾è¿‡æ»¤ã€Key ç²¾ç¡®åŒ¹é…ã€å†…å®¹æ¨¡ç³ŠåŒ¹é…)
- [ ] å®ç° `kb_search` Command (ä»…å…³é”®è¯æ£€ç´¢)
- [ ] å®ç° `SearchFilters` è¿‡æ»¤é€»è¾‘ (æ ‡ç­¾ã€çŸ¥è¯†åº“èŒƒå›´ã€ç¦ç”¨æ¡ç›®è¿‡æ»¤)

**å‰ç«¯ç»„ä»¶**:

- [ ] `SearchPanel.vue` - æœç´¢é¢æ¿ (æ”¯æŒå…³é”®è¯è¾“å…¥ã€æ ‡ç­¾ç­›é€‰)
- [ ] æœç´¢ç»“æœå±•ç¤º (åœ¨ `CaiuList` ä¸­é›†æˆ)

**Composables**:

- [ ] `useKnowledgeSearch.ts` - æœç´¢é€»è¾‘å°è£…

**éªŒæ”¶æ ‡å‡†**: ç”¨æˆ·å¯ä»¥é€šè¿‡å…³é”®è¯å’Œæ ‡ç­¾æœç´¢ CAIUï¼Œç»“æœå‡†ç¡®ä¸”å“åº”è¿…é€Ÿ (< 200ms)ã€‚

---

### é˜¶æ®µ 2A: å¼•ç”¨ç³»ç»Ÿ (Parallel Track) - ä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­

**ç›®æ ‡**: å®ç°åŒå‘é“¾æ¥ä¸å¼•ç”¨å›¾è°±ï¼Œå¢å¼ºçŸ¥è¯†å…³è”æ€§ã€‚

**Rust åç«¯**:

- [ ] å®ç°å¼•ç”¨è§£æå™¨ (`reference-parser`)
  - æ­£åˆ™æå– `[[Key]]` å’Œ `[[LibraryName::Key]]`
  - æ„å»ºå¼•ç”¨å…³ç³»å›¾ (refs / ref_by)
- [ ] å®ç°å¼•ç”¨ç¼“å­˜æœºåˆ¶ (å†·å¯åŠ¨å¼‚æ­¥æ„å»º + å¢é‡æ›´æ–°)
- [ ] å®ç° `kb_get_references` Command (è¿”å›å¼•ç”¨å…³ç³»)

**å‰ç«¯ç»„ä»¶**:

- [ ] `ReferenceGraphView.vue` - å¼•ç”¨å›¾è°±å¯è§†åŒ– (åŸºäº `@vue-flow/core`)
- [ ] ç¼–è¾‘å™¨ä¸­çš„å¼•ç”¨è¡¥å…¨ (è¾“å…¥ `[[` è§¦å‘)
- [ ] å¼•ç”¨é¢„è§ˆæµ®çª— (æ‚¬åœæ˜¾ç¤º CAIU å†…å®¹)

**Composables**:

- [ ] `useReferenceGraph.ts` - å¼•ç”¨å›¾è°±é€»è¾‘

**Utils**:

- [ ] `reference-parser.ts` - å‰ç«¯å¼•ç”¨è§£æå·¥å…·

**éªŒæ”¶æ ‡å‡†**: ç”¨æˆ·å¯ä»¥åœ¨ç¼–è¾‘å™¨ä¸­ä½¿ç”¨ `[[Key]]` åˆ›å»ºå¼•ç”¨ï¼Œå›¾è°±è§†å›¾æ­£ç¡®å±•ç¤ºå¼•ç”¨å…³ç³»ã€‚

---

### é˜¶æ®µ 2B: å‘é‡æ£€ç´¢ (Parallel Track) - ä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­

**ç›®æ ‡**: å®ç°è¯­ä¹‰æ£€ç´¢èƒ½åŠ›ï¼Œæå‡æ£€ç´¢ç²¾å‡†åº¦ã€‚

**Rust åç«¯**:

- [ ] é›†æˆå‘é‡ç´¢å¼•åº“ (`usearch` æˆ– `hnswlib`)
- [ ] å®ç°å‘é‡å­˜å‚¨æ ¼å¼ (`.vec` äºŒè¿›åˆ¶æ–‡ä»¶)
- [ ] å®ç° `kb_vectorize` Command (è°ƒç”¨ LLM API ç”Ÿæˆ embeddings)
- [ ] å®ç°å‘é‡æ£€ç´¢é€»è¾‘ (HNSW æœç´¢)
- [ ] å®ç°å¢é‡å‘é‡åŒ– (æ–°å¢/ä¿®æ”¹ CAIU æ—¶è‡ªåŠ¨æ›´æ–°)
- [ ] å‡çº§ `kb_search` Command (æ”¯æŒè¯­ä¹‰æ£€ç´¢ + å…³é”®è¯æ£€ç´¢æ··åˆ)
- [ ] å®ç° RRF èåˆç®—æ³•

**å‰ç«¯ç»„ä»¶**:

- [ ] `VectorizationDialog.vue` - å‘é‡åŒ–è¿›åº¦å¯¹è¯æ¡†
- [ ] æœç´¢é¢æ¿ä¸­çš„"è¯­ä¹‰æœç´¢"å¼€å…³

**éªŒæ”¶æ ‡å‡†**: ç”¨æˆ·å¯ä»¥è§¦å‘å‘é‡åŒ–ï¼Œè¯­ä¹‰æœç´¢è¿”å›ç›¸å…³ç»“æœï¼Œæ··åˆæ£€ç´¢æ•ˆæœä¼˜äºå•ä¸€æ–¹æ³•ã€‚

---

### é˜¶æ®µ 3: é€é•œç³»ç»Ÿ (Optional Enhancement) - ä¼˜å…ˆçº§ï¼šğŸŸ¢ ä½

**ç›®æ ‡**: å®ç°åŸºäºæ ‡ç­¾çš„åŠ¨æ€çŸ¥è¯†è¿‡æ»¤ã€‚

**å‰ç«¯**:

- [ ] `LensPanel.vue` - é€é•œç®¡ç†é¢æ¿
- [ ] `lensStore.ts` - é€é•œçŠ¶æ€ç®¡ç†
- [ ] `useLensSystem.ts` - é€é•œé€»è¾‘

**Rust åç«¯**:

- [ ] é€é•œé…ç½®æŒä¹…åŒ– (å¯é€‰ï¼Œä¹Ÿå¯ä»¥ä»…å‰ç«¯å­˜å‚¨)

**éªŒæ”¶æ ‡å‡†**: ç”¨æˆ·å¯ä»¥åˆ›å»ºé€é•œï¼Œæ¿€æ´»é€é•œå CAIU åˆ—è¡¨è‡ªåŠ¨è¿‡æ»¤ã€‚

---

### é˜¶æ®µ 4: Chat é›†æˆ - ä¼˜å…ˆçº§ï¼šğŸŸ¡ ä¸­

**ç›®æ ‡**: å°†çŸ¥è¯†åº“ä½œä¸º RAG æ•°æ®æºé›†æˆåˆ° LLM Chatã€‚

**å‰ç«¯ (LLM Chat)**:

- [ ] å®ç° `knowledge-retriever` å¤„ç†å™¨
  - ä» `PipelineContext` æå–ç”¨æˆ·æŸ¥è¯¢
  - è°ƒç”¨ `kb_search` æ£€ç´¢ç›¸å…³ CAIU
  - å°†ç»“æœæ ¼å¼åŒ–ä¸º System Message æ³¨å…¥
  - å¤„ç†å¤šæ¨¡æ€èµ„äº§ (è½¬æ¢ä¸º `attachments`)
- [ ] åœ¨ Agent é…ç½®ç•Œé¢æ·»åŠ çŸ¥è¯†åº“ç»‘å®šé€‰é¡¹
- [ ] æ³¨å†Œ `knowledge_base` Anchor (å¯é€‰)

**éªŒæ”¶æ ‡å‡†**: åœ¨ Chat ä¸­æé—®æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æ£€ç´¢çŸ¥è¯†åº“å¹¶æ³¨å…¥ä¸Šä¸‹æ–‡ï¼ŒLLM å›ç­”åŸºäºçŸ¥è¯†åº“å†…å®¹ã€‚

---

### é˜¶æ®µ 5: é«˜çº§æ£€ç´¢ç­–ç•¥ (Future Enhancement) - ä¼˜å…ˆçº§ï¼šğŸ”µ æœ€ä½

**ç›®æ ‡**: å®ç°æ®‹å·®é‡‘å­—å¡”ã€è¾©è¯æ£€ç´¢ç­‰é«˜çº§ç®—æ³•ã€‚

**Rust åç«¯**:

- [ ] å®ç°æ®‹å·®é‡‘å­—å¡”æ£€ç´¢ (`pyramid_search`)
- [ ] å®ç°åæŒ¯æ£€æµ‹ (`detect_polarization`)
- [ ] å®ç°åŠ¨æ€ Beta å…¬å¼ (`QueryIntent`)
- [ ] å®ç°é¢†åŸŸé—¨æ§ (`KnowledgeDomain`)

**éªŒæ”¶æ ‡å‡†**: é«˜çº§æ£€ç´¢ç­–ç•¥åœ¨å¤æ‚æŸ¥è¯¢åœºæ™¯ä¸‹æ˜¾è‘—æå‡æ£€ç´¢è´¨é‡ã€‚

---

### é˜¶æ®µ 6: å¯¼å…¥/å¯¼å‡ºä¸å·¥å…·é›†æˆ - ä¼˜å…ˆçº§ï¼šğŸŸ¢ ä½

**å‰ç«¯**:

- [ ] `ImportExportDialog.vue` - å¯¼å…¥/å¯¼å‡ºå¯¹è¯æ¡†
- [ ] æ”¯æŒå¯¼å‡ºä¸º Markdown æ–‡ä»¶å¤¹
- [ ] æ”¯æŒä» Obsidian/Notion å¯¼å…¥

**Utils**:

- [ ] `export.ts` - å¯¼å‡ºé€»è¾‘
- [ ] `markdown.ts` - Markdown å¤„ç†å·¥å…·

**éªŒæ”¶æ ‡å‡†**: ç”¨æˆ·å¯ä»¥å¯¼å‡ºçŸ¥è¯†åº“ä¸ºæ ‡å‡†æ ¼å¼ï¼Œæ–¹ä¾¿è¿ç§»å’Œå¤‡ä»½ã€‚

---

## å¹¶è¡Œå¼€å‘å»ºè®®

```mermaid
gantt
    title çŸ¥è¯†åº“å·¥å…·å®æ–½ç”˜ç‰¹å›¾
    dateFormat  YYYY-MM-DD
    section åŸºç¡€å±‚
    æ•°æ®ç»“æ„ä¸æŒä¹…åŒ–     :done, foundation, 2026-01-29, 3d
    åŸºç¡€ Command API      :done, api, after foundation, 2d

    section å¹¶è¡Œè½¨é“ A
    åŸºç¡€ UI æ¡†æ¶          :active, ui, 2026-01-29, 5d
    å…³é”®è¯æ£€ç´¢            :active, search, 2026-01-29, 4d

    section å¹¶è¡Œè½¨é“ B
    å¼•ç”¨ç³»ç»Ÿ              :ref, after search, 5d
    å‘é‡æ£€ç´¢              :vector, after search, 6d

    section é›†æˆé˜¶æ®µ
    Chat é›†æˆ             :chat, after vector, 3d
    é€é•œç³»ç»Ÿ              :lens, after ui, 4d

    section å¢å¼ºé˜¶æ®µ
    é«˜çº§æ£€ç´¢ç­–ç•¥          :advanced, after chat, 7d
    å¯¼å…¥å¯¼å‡º              :export, after lens, 3d
```

**å…³é”®åŸåˆ™**:

1. **åŸºç¡€æ•°æ®å±‚ä¼˜å…ˆ**: æ‰€æœ‰æ¨¡å—ä¾èµ–æ•°æ®ç»“æ„ï¼Œå¿…é¡»æœ€å…ˆå®Œæˆã€‚
2. **UI ä¸æ£€ç´¢å¹¶è¡Œ**: UI æ¡†æ¶å’Œå…³é”®è¯æ£€ç´¢å¯ä»¥åŒæ—¶å¼€å‘ï¼Œäº’ä¸é˜»å¡ã€‚
3. **å¼•ç”¨ä¸å‘é‡å¹¶è¡Œ**: ä¸¤è€…ç›¸å¯¹ç‹¬ç«‹ï¼Œå¯ä»¥åˆ†é…ç»™ä¸åŒå¼€å‘è€…ã€‚
4. **å°½æ—©å»ºç«‹é—­ç¯**: é˜¶æ®µ 0 + 1A + 1B å®Œæˆåï¼Œå³å¯æ‹¥æœ‰ä¸€ä¸ªå¯ç”¨çš„çŸ¥è¯†åº“å·¥å…·ã€‚
5. **å¢é‡é›†æˆ**: æ¯ä¸ªé˜¶æ®µå®Œæˆåç«‹å³é›†æˆæµ‹è¯•ï¼Œé¿å…æœ€åé˜¶æ®µçš„"å¤§çˆ†ç‚¸"é›†æˆã€‚

---

## åäºŒã€å¼€æ”¾æ€§é—®é¢˜ (Open Questions)

1. **å‘é‡æ¨¡å‹é€‰æ‹©**: æ˜¯å¦å†…ç½®è½»é‡çº§ embedding æ¨¡å‹ï¼ˆå¦‚ `all-MiniLM-L6-v2`ï¼‰ï¼Œè¿˜æ˜¯å®Œå…¨ä¾èµ–å¤–éƒ¨ APIï¼Ÿ
   - æš‚ä¸æ‰“ç®—å†…ç½®æ¨¡å‹ï¼Œæœ‰éœ€è¦æœ¬åœ°å¯ä»¥ä½¿ç”¨ollamaã€lmstudioä¹‹ç±»çš„ç»™æ¥ä¸Šï¼Œå®ƒä»¬åœ¨è¿™æ–¹é¢çš„è¿è¡Œæ•ˆç‡æ›´å¥½
2. **ç¦»çº¿èƒ½åŠ›**: æ˜¯å¦éœ€è¦æ”¯æŒå®Œå…¨ç¦»çº¿çš„å…³é”®è¯æ£€ç´¢æ¨¡å¼ï¼Ÿ
3. **å¤šè¯­è¨€æ”¯æŒ**: æ˜¯å¦éœ€è¦é’ˆå¯¹ä¸­æ–‡ä¼˜åŒ–åˆ†è¯å’Œæ£€ç´¢ç­–ç•¥ï¼Ÿ
4. **ç‰ˆæœ¬æ§åˆ¶**: æ˜¯å¦éœ€è¦ä¸ºçŸ¥è¯†åº“æä¾› Git-like çš„ç‰ˆæœ¬ç®¡ç†ï¼Ÿ
5. **åä½œåŠŸèƒ½**: æœªæ¥æ˜¯å¦è€ƒè™‘å¤šç”¨æˆ·åä½œç¼–è¾‘ï¼Ÿ

---

## åä¸‰ã€æ€§èƒ½æŒ‡æ ‡ (Performance Targets)

| æŒ‡æ ‡             | ç›®æ ‡å€¼                     | å¤‡æ³¨                      |
| :--------------- | :------------------------- | :------------------------ |
| å†·å¯åŠ¨åŠ è½½æ—¶é—´   | < 2s (10k æ¡ç›®)            | åŒ…å«ç´¢å¼•æ„å»º              |
| è¯­ä¹‰æ£€ç´¢å“åº”æ—¶é—´ | < 500ms                    | Top-10 ç»“æœ               |
| å‘é‡åŒ–é€Ÿåº¦       | > 100 æ¡ç›®/ç§’              | ä½¿ç”¨å¤–éƒ¨ API æ—¶å–å†³äºç½‘ç»œ |
| å†…å­˜å ç”¨         | < 200MB (10k æ¡ç›®)         | ä¸å«å‘é‡ç´¢å¼•              |
| å‘é‡ç´¢å¼•å†…å­˜å ç”¨ | < 500MB (10k æ¡ç›®, 384 ç»´) | HNSW ç´¢å¼•                 |

---

## é™„å½• A: æœ¯è¯­è¡¨ (Glossary)

- **CAIU (Contextual Atomic Information Unit)**: ä¸Šä¸‹æ–‡åŸå­ä¿¡æ¯å•å…ƒï¼ŒçŸ¥è¯†åº“çš„æœ€å°å­˜å‚¨å•ä½ã€‚
- **Lens (é€é•œ)**: åŸºäºæ ‡ç­¾çš„åŠ¨æ€çŸ¥è¯†è¿‡æ»¤å™¨ã€‚
- **Anchor (é”šç‚¹)**: CAIU ä¸Šçš„æ ‡ç­¾ï¼Œç”¨äºé€é•œè¿‡æ»¤ã€‚
- **RAG (Retrieval-Augmented Generation)**: æ£€ç´¢å¢å¼ºç”Ÿæˆï¼Œç»“åˆçŸ¥è¯†æ£€ç´¢ä¸ LLM ç”Ÿæˆçš„æŠ€æœ¯ã€‚
- **HNSW (Hierarchical Navigable Small World)**: å±‚æ¬¡åŒ–å¯å¯¼èˆªå°ä¸–ç•Œå›¾ï¼Œä¸€ç§é«˜æ•ˆçš„è¿‘ä¼¼æœ€è¿‘é‚»æœç´¢ç®—æ³•ã€‚
- **RRF (Reciprocal Rank Fusion)**: å€’æ•°æ’åèåˆï¼Œä¸€ç§å¤šè·¯æ£€ç´¢ç»“æœèåˆç®—æ³•ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2026-01-29
**çŠ¶æ€**: Draft (è‰æ¡ˆ)
