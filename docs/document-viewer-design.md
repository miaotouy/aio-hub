# 文档查看器组件设计方案

## 1. 概述

设计一个灵活、可复用的文档查看器组件 `DocumentViewer`，用于在应用内预览各种文本文件。该组件不应是弹窗形式，而是一个基础的合成组件，以便在不同场景下灵活使用（如嵌入对话框、抽屉、面板等）。

### 1.1 核心特性

- ✅ **多数据源支持**：支持文件路径、直接内容（字符串/二进制）
- ✅ **智能类型检测**：基于魔数、扩展名、MIME 类型提示的多级检测策略
- ✅ **Markdown 特殊支持**：提供源码/预览模式切换
- ✅ **语法高亮**：自动为代码文件选择合适的语法高亮
- ✅ **主题适配**：完全适配项目的主题外观系统
- ✅ **工具栏功能**：复制、下载、换行控制等实用功能

### 1.2 应用场景

- **资产管理器**：预览导入的文本文件/代码文件
- **LLM 聊天**：预览 AI 生成的代码片段
- **API 测试器**：预览响应内容
- **组件测试**：测试各种边缘情况

---

## 2. 架构设计

### 2.1 组件结构

```
src/components/common/
├── DocumentViewer.vue          # 主组件
├── DocumentViewer-example.md   # 使用示例文档

src/composables/
└── useDocumentViewer.ts        # 核心逻辑 Composable

src/utils/
├── fileTypeDetector.ts         # 文件类型检测（需改进）
└── mimeToLanguage.ts           # MIME 类型到编辑器语言的映射
```

### 2.2 数据流图

```
┌─────────────────────────────────────────┐
│         DocumentViewer Props            │
│  - content?: string | Uint8Array        │
│  - filePath?: string                    │
│  - fileName?: string                    │
│  - fileTypeHint?: string                │
└─────────────┬───────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│      useDocumentViewer Composable       │
│  1. 确定数据源                          │
│  2. 加载/解码内容                       │
│  3. 检测文件类型                        │
│  4. 映射语法高亮语言                    │
└─────────────┬───────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│         改进的 fileTypeDetector         │
│  - detectMimeTypeFromBuffer()           │
│  - inferMimeTypeFromHint()              │
│  - detectMimeType() (重构)              │
└─────────────┬───────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│          mimeToLanguage 映射            │
│  将 MIME 转换为编辑器支持的语言标识     │
└─────────────┬───────────────────────────┘
              │
              ▼
┌─────────────────────────────────────────┐
│         RichCodeEditor / Renderer       │
│  - 代码高亮显示                          │
│  - Markdown 渲染（特殊处理）             │
│  - HTML 渲染（特殊处理）                 │
└─────────────────────────────────────────┘
```