# AIO Hub 移动端适配策略概念文档

## 1. 愿景与目标

### 1.1. 核心目标
将 AIO Hub 的核心功能，特别是 **LLM Chat**，适配到移动端平台 (Android/iOS)，提供流畅、稳定且符合移动用户习惯的体验。

### 1.2. 设计原则
- **渐进式增强**: 桌面端体验保持完整，移动端在此基础上进行适配和优化，而非完全重写。
- **功能聚焦**: 移动端优先保证核心功能（聊天）的可用性，桌面端的辅助、重度功能（如窗口分离、高级视图）可进行裁剪或简化。
- **平台感知**: 应用应能感知运行环境 (桌面/移动)，并动态加载相应的 UI 和逻辑。
- **性能优先**: 在移动设备上，性能和响应速度是关键指标，必要时可牺牲部分视觉效果。

## 2. 核心挑战与技术分析

### 2.1. 后端 (Rust) 适配
当前后端代码包含大量桌面专用依赖，是移植的最大障碍。

- **不兼容依赖**:
  - `rdev` (全局鼠标监听): 移动端无此概念，必须移除。
  - `trash` (回收站): 移动端文件系统沙盒化，无统一回收站。
  - `window_vibrancy` (窗口特效): 移动端不支持，且性能开销大。
- **解决方案**:
  - **条件编译**: 大量使用 `#[cfg(not(any(target_os = "android", target_os = "ios")))]` 宏，在编译时将桌面专用代码模块排除在移动端构建之外。
  - **功能降级**: 对于 `trash`，移动端实现可降级为直接删除文件 (`std::fs::remove_file`)。
  - **Tauri API 替代**: 文件操作应优先使用 `tauri-plugin-fs`，它已对各平台做了抽象。

### 2.2. UI/UX 响应式重构
桌面端的布局无法直接在移动端使用，需要设计一套全新的响应式方案。

- **全局布局 (`App.vue`, `MainSidebar.vue`)**:
  - **问题**: 固定侧边栏 + 内容区的布局在小屏上会挤压内容空间。
  - **方案**:
    - **媒体查询 (CSS Media Queries)**: 侦测屏幕宽度。
    - **移动端布局**: 在小屏幕下，`MainSidebar` 切换为 `ElDrawer` (抽屉组件)，通过顶部的汉堡按钮触发。
- **LLM Chat 复杂布局 (`LlmChat.vue`)**:
  - **问题**: 左右双侧边栏设计在移动端完全不可用。
  - **方案**:
    - **抽屉化**: 将左右侧边栏 (`AgentsSidebar`, `SessionsSidebar`) 全部改造为从屏幕边缘滑出的抽屉。
    - **简化头部**: `ChatArea.vue` 的头部信息栏需简化，将不常用操作收纳进一个“更多”菜单。
- **输入框 (`MessageInput.vue`)**:
  - **问题**: 软键盘弹出时对布局的挤压是移动端最常见的问题。组件的高度拖拽调整功能在触摸屏上也不适用。
  - **方案**:
    - **移除桌面功能**: 移除高度拖拽手柄 (`resize-handle`) 和 `ComponentHeader` 拖拽逻辑。
    - **优化高度**: 限制 `textarea` 的 `max-height` 为一个较小的值（如 4-5 行），避免其占据过多屏幕空间。
    - **视口监听**: 可能需要监听视口大小变化，在键盘弹出时调整布局。

### 2.3. 高级功能裁剪与适配

- **窗口分离 (`useDetachable`)**:
  - **问题**: Tauri Mobile 不支持多窗口。
  - **方案**: 在 `composables` 层通过平台判断，使所有 `detach` 相关功能在移动端失效或直接隐藏对应 UI 元素。
- **对话树图 (`conversation-tree-graph`)**:
  - **问题**: 复杂的 `vue-flow` 图形在小屏上难以交互。
  - **方案**: 在 `ChatArea.vue` 中，当检测到是移动端时，禁用“树图”视图模式切换选项，或提供一个简化的只读列表视图。
- **文件导出 (`useExportManager.ts`)**:
  - **问题**: 桌面端的文件保存对话框在移动端不可用。
  - **方案**: 重写导出逻辑，调用 Tauri Mobile 的 `share` API，允许用户通过原生分享菜单将内容发送到其他应用。

## 3. 分阶段实施计划

### 阶段一：基础编译与运行 (目标：让应用在模拟器里跑起来)
1.  **后端改造**: 使用条件编译 (`#[cfg]`) 屏蔽所有桌面专用库。
2.  **构建配置**: 修改 `tauri.conf.json` 和 `Cargo.toml`，添加移动端构建目标。
3.  **禁用分离功能**: 在前端全局禁用所有窗口分离逻辑。

### 阶段二：核心 UI 适配 (目标：实现 MVP 可用)
1.  **全局导航**: 将 `MainSidebar.vue` 改造为移动端抽屉式导航。
2.  **LLM Chat 布局**: 将 `LlmChat.vue` 的左右侧边栏改为抽屉模式。
3.  **输入框简化**: 移除 `MessageInput.vue` 的桌面功能，优化软键盘适配。
4.  **头部简化**: 简化 `ChatArea.vue` 的头部信息栏。

### 阶段三：高级功能适配与优化 (目标：提升体验)
1.  **禁用高级视图**: 禁用“对话树图”等不适合移动端的复杂视图。
2.  **重构导出功能**: 使用 Tauri Mobile 的 API 重写文件导出逻辑。
3.  **性能分析**: 针对 `useChatContextBuilder.ts` 等复杂模块进行性能测试与优化。
4.  **触摸交互优化**: 将 `hover` 效果改为适合触摸的 `click` 或长按事件。

## 4. 风险与缓解措施

- **Tauri Mobile 限制**: Tauri v2 的移动端支持仍在发展中，可能存在未知的 API 限制或 Bug。
  - **缓解**: 密切关注 Tauri 官方文档和社区，保持依赖更新。
- **性能瓶颈**: 移动设备的性能远不如桌面端，复杂的 Vue `composables` 和渲染逻辑可能导致卡顿。
  - **缓解**: 在开发过程中持续进行性能测试，利用 Vue Devtools 分析瓶颈。
- **平台差异**: Android 和 iOS 的原生行为（如文件权限、通知）有差异。
  - **缓解**: 尽可能使用 Tauri 提供的跨平台抽象 API，对必须的平台特定代码进行隔离。