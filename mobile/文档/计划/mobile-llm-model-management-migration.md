# 移动端 LLM 模型管理功能移植计划

## 1. 现状分析

目前移动端的 `ProfileEditor.vue` 仅实现了最基础的渠道配置，模型管理部分存在以下缺失：

- **获取逻辑简陋**：点击“自动获取”会直接覆盖当前模型列表，缺乏预览和选择过程。
- **展示信息单一**：模型列表仅显示 ID 和名称，缺少分组、能力标签（Vision, Thinking 等）的展示。
- **管理功能缺失**：不支持手动添加模型、单项编辑、批量删除或清空操作。
- **配置项不全**：缺少 Token 限制、价格配置、思考模式（Reasoning Effort）等高级参数的编辑。

## 2. 移植目标

将桌面端成熟的模型管理逻辑完整移植到移动端，并针对移动端 UI 规范进行适配：

- **能力对齐**：支持模型分组折叠、能力筛选、搜索过滤。
- **精细化管理**：支持获取后的选择性添加、手动编辑单个模型属性。
- **交互优化**：使用 Varlet UI 的全屏弹窗（Popup）和折叠面板（Collapse）优化移动端体验。

## 3. 详细设计

### 3.1 基础配置 (`config/`)

- **`model-capabilities.ts`**: 移植桌面端的能力定义，映射 `lucide-vue-next` 图标。
  - `vision`, `thinking`, `toolUse`, `webSearch`, `document` 等。

### 3.2 核心组件 (`components/`)

#### ModelList.vue (已添加模型列表)

- **展示**：按 `group` 分组显示，支持 `var-collapse` 折叠。
- **标签**：显示能力图标（彩色标识）和模型 ID（Mono 字体）。
- **操作**：
  - 点击项打开 `ModelEditorPopup`。
  - 右侧提供删除按钮，顶部提供“清空”功能。

#### ModelFetcherPopup.vue (模型获取弹窗)

- **触发**：点击渠道编辑页的“自动获取”。
- **功能**：
  - 调用 `fetchModelsFromApi` 获取原始列表。
  - 提供搜索框和能力筛选下拉框（`var-select`）。
  - 分组展示模型，支持“全选/取消全选”。
  - 自动过滤已存在的模型。

#### ModelEditorPopup.vue (模型编辑器弹窗)

- **功能**：手动添加或修改模型。
- **配置项**：
  - 基础：ID、名称、分组、描述、图标（对接 `IconSelector`）。
  - Token：上下文窗口、输出限制（带常用预设值）。
  - 能力：开关矩阵，控制模型支持的功能。
  - 价格：输入/输出/请求/图像价格。
  - 思考模式：配置 `thinkingConfigType` 及可用等级。

### 3.3 逻辑迁移

- **名称格式化**：移植 `formatModelName` 逻辑（处理斜杠和连字符）。
- **能力合并**：移植 `getMatchedProperties` 逻辑，确保 API 返回数据与预设规则正确合并。
- **自动应用预设**：在编辑器中输入 ID 后，支持根据 `model-metadata` 自动填充图标和分组。

## 4. 实施步骤

### 第一阶段：基础设施 (Infrastructure)

1. 创建 `model-capabilities.ts` 配置文件。
2. 在 `types/common.ts` 中完善 `LlmModelInfo` 和 `ModelCapabilities` 类型定义，确保与桌面端对齐。

### 第二阶段：展示组件 (Display)

1. 实现 `ModelList.vue`，集成到 `ProfileEditor.vue`。
2. 适配明暗主题下的图标颜色。

### 第三阶段：功能弹窗 (Functional Popups)

1. 开发 `ModelFetcherPopup.vue`，实现搜索、筛选和分组选择逻辑。
2. 开发 `ModelEditorPopup.vue`，实现完整的模型属性编辑。

### 第四阶段：集成与优化 (Integration)

1. 重构 `ProfileEditor.vue`，移除旧的简单列表逻辑。
2. 优化移动端滚动避让（Keyboard Avoidance）在多层弹窗下的表现。
3. 测试各主流 Provider（OpenAI, Claude, Gemini）的模型获取流程。

## 5. UI 设计规范

### 5.1 设计原则

- **Material Design 3**: 遵循 MD3 设计语言，使用 Varlet UI 组件库。
- **圆角规范**: 卡片 `16-20px`，按钮/输入框 `12px`，小标签 `8px`。
- **颜色系统**: 使用 CSS 变量 `--color-*` 系列，支持明暗主题自动切换。
- **间距规范**: 页面边距 `24px`，卡片内边距 `16-20px`，元素间距 `12-16px`。

### 5.2 ModelList 组件设计

```
┌─────────────────────────────────────────────────────┐
│  已添加 12 个模型          [手动添加] [从API获取]   │
├─────────────────────────────────────────────────────┤
│ ▼ GPT-4 系列 (4)                          [删除组] │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [🤖] GPT-4o                    👁️ 🧠 🔧        │ │
│ │      gpt-4o-2024-08-06                    [编辑]│ │
│ └─────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────┐ │
│ │ [🤖] GPT-4 Turbo               👁️ 🔧           │ │
│ │      gpt-4-turbo-preview                  [编辑]│ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ ▶ Claude 系列 (3)                         [删除组] │
│ ─────────────────────────────────────────────────── │
│ ▶ Gemini 系列 (5)                         [删除组] │
└─────────────────────────────────────────────────────┘
```

**组件结构**:

- 顶部操作栏：模型计数 + 操作按钮（手动添加、从API获取）
- 分组折叠面板：使用 `var-collapse` 实现
- 模型卡片：图标 + 名称 + 能力标签 + 操作按钮

**能力图标设计**:
| 能力 | 图标 | 颜色 |
|------|------|------|
| Vision | `Eye` | `#10B981` (绿色) |
| Thinking | `Brain` | `#8B5CF6` (紫色) |
| Tool Use | `Wrench` | `#F59E0B` (橙色) |
| Web Search | `Globe` | `#3B82F6` (蓝色) |
| Code Execution | `Code` | `#EC4899` (粉色) |
| Document | `FileText` | `#6366F1` (靛蓝) |

### 5.3 ModelFetcherPopup 组件设计

```
┌─────────────────────────────────────────────────────┐
│ ← 从 API 添加模型                           [添加] │
├─────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────┐ │
│ │ 🔍 搜索模型名称或 ID...                         │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 能力筛选: [👁️ 视觉] [🧠 思考] [🔧 工具]  [全选]   │
│                                                     │
├─────────────────────────────────────────────────────┤
│ ▼ GPT-4 系列 (8)                    [全选] [取消]  │
│ ┌─────────────────────────────────────────────────┐ │
│ │ ☑️ [🤖] GPT-4o                   👁️ 🧠 🔧      │ │
│ │        gpt-4o-2024-08-06                        │ │
│ └─────────────────────────────────────────────────┘ │
│ ┌─────────────────────────────────────────────────┐ │
│ │ ☐ [🤖] GPT-4 Turbo              👁️ 🔧  [已存在]│ │
│ │        gpt-4-turbo-preview                      │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ ▶ Claude 系列 (5)                   [全选] [取消]  │
│ ▶ Gemini 系列 (12)                  [全选] [取消]  │
├─────────────────────────────────────────────────────┤
│                        已选择 3 个模型              │
└─────────────────────────────────────────────────────┘
```

**交互设计**:

- 全屏弹窗 (`position="right"`)，从右侧滑入
- 顶部固定搜索栏和筛选标签
- 中间滚动区域展示分组模型
- 底部固定显示已选数量和确认按钮
- 已存在的模型显示灰色标签，不可选择

### 5.4 ModelEditorPopup 组件设计

```
┌─────────────────────────────────────────────────────┐
│ ← 编辑模型                                   [保存] │
├─────────────────────────────────────────────────────┤
│                                                     │
│ ── 基本信息 ──────────────────────────────────────  │
│                                                     │
│ 模型 ID *                          [✨ 应用预设]   │
│ ┌─────────────────────────────────────────────────┐ │
│ │ gpt-4o-2024-08-06                               │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 显示名称 *                                          │
│ ┌─────────────────────────────────────────────────┐ │
│ │ GPT-4o                                          │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 分组                                                │
│ ┌─────────────────────────────────────────────────┐ │
│ │ GPT-4 系列                                      │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 图标                                    [选择预设]  │
│ ┌─────────────────────────────────────────────────┐ │
│ │ openai-color.svg                                │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ ── Token 限制 ────────────────────────────────────  │
│                                                     │
│ 上下文窗口                                          │
│ [128K ▼] ┌────────────────────────────────────────┐ │
│          │ 128000                                 │ │
│          └────────────────────────────────────────┘ │
│                                                     │
│ 输出限制                                            │
│ [16K ▼]  ┌────────────────────────────────────────┐ │
│          │ 16384                                  │ │
│          └────────────────────────────────────────┘ │
│                                                     │
│ ── 模型能力 ──────────────────────────────────────  │
│                                                     │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ │
│ │ 👁️ 视觉  [✓]│ │ 🧠 思考  [✓]│ │ 🔧 工具  [ ]  │ │
│ └──────────────┘ └──────────────┘ └──────────────┘ │
│ ┌──────────────┐ ┌──────────────┐ ┌──────────────┐ │
│ │ 🌐 联网  [ ]│ │ 💻 代码  [ ]│ │ 📄 文档  [✓]   │ │
│ └──────────────┘ └──────────────┘ └──────────────┘ │
│                                                     │
│ ── 思考配置 ──────────────────────────────────────  │
│                                                     │
│ 配置模式                                            │
│ ○ 无  ○ 开关模式  ● 预算模式  ○ 等级模式              │
│                                                     │
│ ── 价格配置 ──────────────────────────────────────  │
│                                                     │
│ 输入价格 ($/1M tokens)                              │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 2.50                                            │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
│ 输出价格 ($/1M tokens)                              │
│ ┌─────────────────────────────────────────────────┐ │
│ │ 10.00                                           │ │
│ └─────────────────────────────────────────────────┘ │
│                                                     │
├─────────────────────────────────────────────────────┤
│ [🗑️ 删除此模型]                                    │
└─────────────────────────────────────────────────────┘
```

**交互设计**:

- 全屏弹窗 (`position="right"`)，从右侧滑入
- 分区展示：基本信息、Token 限制、模型能力、思考配置、价格配置
- 能力开关使用网格布局，每行 3 个
- "应用预设"按钮：根据模型 ID 自动填充图标、分组和能力
- 底部危险区域：删除按钮（仅编辑模式显示）

### 5.5 样式规范

**卡片样式**:

```css
.model-card {
  background: var(--color-surface-container-low);
  border: 1px solid var(--color-outline-variant);
  border-radius: 16px;
  padding: 16px;
}

.model-card.selected {
  border-color: var(--color-primary);
  background: color-mix(in srgb, var(--color-primary) 8%, var(--color-surface));
}

.model-card.disabled {
  opacity: 0.5;
  pointer-events: none;
}
```

**能力标签样式**:

```css
.capability-tag {
  display: inline-flex;
  align-items: center;
  gap: 4px;
  padding: 4px 8px;
  border-radius: 8px;
  font-size: 12px;
  background: var(--color-surface-container);
}

.capability-icon {
  width: 16px;
  height: 16px;
}
```

**分组标题样式**:

```css
.group-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--color-surface-container);
  border-radius: 12px;
  margin-bottom: 8px;
}

.group-title {
  display: flex;
  align-items: center;
  gap: 8px;
  font-weight: 600;
}

.group-count {
  font-size: 12px;
  padding: 2px 8px;
  background: var(--color-primary-container);
  color: var(--color-on-primary-container);
  border-radius: 10px;
}
```

## 6. 验收标准

- [ ] 能够成功从 API 获取模型并进入预览选择界面。
- [ ] 获取界面支持按名称搜索和按能力（如"视觉"）筛选。
- [ ] 已添加的模型按分组显示，且能正确显示能力图标。
- [ ] 可以手动编辑模型的 Token 限制和价格信息。
- [ ] 所有弹窗在键盘弹出时不会遮挡当前输入框。
- [ ] UI 风格与现有移动端组件保持一致（圆角、颜色、间距）。
- [ ] 明暗主题切换时，所有组件正确响应。
