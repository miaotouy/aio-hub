/**
 * 主题外观增强样式
 * 包含壁纸、透明度、模糊效果等相关的 CSS 变量和类
 */

:root {
  /* --- 核心变量 (由 JS 动态更新) --- */
  --ui-blur: 15px;
  --wallpaper-url: none; /* JS 注入：壁纸的 URL */
  --wallpaper-opacity: 1; /* JS 注入：壁纸的不透明度 */
  --wallpaper-size: cover; /* JS 注入：填充模式 */
  --wallpaper-repeat: no-repeat; /* JS 注入：重复模式 */
  --wallpaper-tile-transform: none; /* JS 注入：拼贴模式的变换 */
  --window-bg-opacity: 1;
  --border-opacity: 0.9; /* 边线不透明度 */
  --card-bg-rgb: 255, 255, 255; /* 默认亮色主题的卡片背景 RGB */

  /*
    透明度变量 (如 --card-opacity, --sidebar-opacity 等)
    现在完全由 useThemeAppearance.ts 动态计算并注入，
    以确保与 UI 设置实时同步。
  */
  --vscode-editor-background: var(--bg-color) !important;
  --vscode-editorGutter-background: var(--sidebar-bg) !important;
}

html.dark {
  --card-bg-rgb: 42, 42, 42; /* 暗色主题的卡片背景 RGB */
}

/* ========================================================================== */
/* 全局背景和壁纸
/* ========================================================================== */

body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-image: var(--wallpaper-url);
  background-size: var(--wallpaper-size);
  background-repeat: var(--wallpaper-repeat);
  background-position: center;
  background-attachment: fixed;
  opacity: var(--wallpaper-opacity);
  transform: var(--wallpaper-tile-transform);
  z-index: -2; /* 确保在所有内容之下 */
  will-change: transform, opacity; /* 性能优化 */
}

/* 应用窗口本身的背景色 */
html,
body {
  background-color: rgba(var(--bg-color-rgb), var(--window-bg-opacity));
}
/* ========================================================================== */
/* 可复用工具类
/* ========================================================================== */

/**
 * 通用毛玻璃效果
 * 将这个类应用到需要模糊背景的组件上
 */
.glass-effect {
  backdrop-filter: blur(var(--ui-blur));
  -webkit-backdrop-filter: blur(var(--ui-blur));
}

/**
 * 卡片毛玻璃效果
 * 专为卡片类组件设计，使用由 JS 注入的 --card-opacity 变量
 */
.glass-card {
  background-color: rgba(var(--card-bg-rgb), var(--card-opacity)) !important;
  backdrop-filter: blur(var(--ui-blur));
  -webkit-backdrop-filter: blur(var(--ui-blur));
}

/**
 * 侧边栏毛玻璃效果
 * 专为侧边栏设计，使用由 JS 注入的 --sidebar-opacity 变量
 */
.glass-sidebar {
  background-color: rgba(var(--sidebar-bg-rgb, var(--card-bg-rgb)), var(--sidebar-opacity)) !important;
  backdrop-filter: blur(var(--ui-blur));
  -webkit-backdrop-filter: blur(var(--ui-blur));
}

/**
 * 弹窗/覆盖层毛玻璃效果
 * 专为 Dialog, Popover, Dropdown 等设计，使用由 JS 注入的 --overlay-opacity 变量
 */
.glass-overlay {
  background-color: rgba(var(--container-bg-rgb), var(--overlay-opacity)) !important;
  backdrop-filter: blur(var(--ui-blur));
  -webkit-backdrop-filter: blur(var(--ui-blur));
}

/* ========================================================================== */
/* 编辑器主题覆盖
/* ========================================================================== */
/*
  Monaco Editor 会动态创建 style 标签并插入到 head 中，其优先级非常高。
  为了覆盖这些由 JS 动态插入的内联样式，我们需要使用更高特异性的选择器，
  并确保这些规则在全局样式表中，以便在组件加载后依然生效。
*/

/* 核心：覆盖编辑器默认的、不透明的背景色 */
.monaco-editor .monaco-editor-background,
.monaco-editor .lines-content {
  background-color: var(--vscode-editor-background) !important;
}

/* 覆盖行号区域 (gutter) 的背景色 */
.monaco-editor .margin,
.monaco-editor .gutter-container {
  background-color: var(--vscode-editorGutter-background) !important;
}

/* 针对 Diff Editor 的特殊覆盖 */
.monaco-diff-editor .monaco-editor .lines-content {
  background-color: var(--vscode-editor-background) !important;
}

:deep(.text-diff-container) {
  /* 
    直接覆盖 Monaco 的核心背景变量。
    使用 !important 是为了确保我们的定义能战胜 Monaco 内部的所有定义。
    这里可以直接设为 transparent，或者你想要的 rgba 半透明色。
  */
  --vscode-editor-background: transparent !important;
}